{"componentChunkName":"component---src-templates-post-tsx","path":"/category/blog/mlops/mnist_training_vertex/","result":{"data":{"site":{"siteMetadata":{"title":"어서OpShow","author":"장수완","siteUrl":"https://ssuwani.github.io"}},"markdownRemark":{"id":"88567ab3-ada2-53c6-8c6e-4971db878196","excerpt":"조대협님의 블로그를 참고했습니다! 감사합니다.  https://bcho.tistory.com/1383 구글에서 제공하는 통합 머신러닝 플랫폼인 Vertex AI를 이용해서 MNIST 데이터를 학습하고 모델을 배포하고 Endpoint…","html":"<div class=\"custom-block info\"><div class=\"custom-block-heading\">조대협님의 블로그를 참고했습니다! 감사합니다. </div><div class=\"custom-block-body\"><p><a href=\"https://bcho.tistory.com/1383\">https://bcho.tistory.com/1383</a></p></div></div>\n<p>구글에서 제공하는 통합 머신러닝 플랫폼인 Vertex AI를 이용해서 MNIST 데이터를 학습하고 모델을 배포하고 Endpoint를 생성해 서빙하는 것까지 실습해보겠습니다!</p>\n<p>목차</p>\n<ol>\n<li>train.py 파일 만들기</li>\n<li>도커 컨테이너로 패키징하기</li>\n<li>Vertex AI에 Train JOB 생성하기</li>\n<li>배포 및 서빙</li>\n<li>Test</li>\n</ol>\n<h2 id=\"1-trainpy-파일-만들기\" style=\"position:relative;\"><a href=\"#1-trainpy-%ED%8C%8C%EC%9D%BC-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"1 trainpy 파일 만들기 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. train.py 파일 만들기</h2>\n<p>moist 데이터를 불러와서 간단한 Linear 모델을 만들고 모델 학습 및 저장하는 코드이다.</p>\n<p>여기서 주의깊게 봐야할 곳은 마지막에 있는 <code class=\"language-text\">model.save</code> 부분이다. GCS의 bucket으로 경로가 되어있는 것을 볼 수 있다. </p>\n<ul>\n<li>GCS의 버킷의 region은 <code class=\"language-text\">us-central1</code> 으로 지정해서 만들자. (왜인지 한국으로 하면 엔드포인트 생성 시 오류가 난다. ㅠㅠ)</li>\n<li>경로의 마지막은 <code class=\"language-text\">model</code> 이라는 폴더로 되어 있어야 한다. </li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">import</span> tensorflow <span class=\"token keyword\">as</span> tf\n\nmnist <span class=\"token operator\">=</span> tf<span class=\"token punctuation\">.</span>keras<span class=\"token punctuation\">.</span>datasets<span class=\"token punctuation\">.</span>mnist\n<span class=\"token punctuation\">(</span>train_x<span class=\"token punctuation\">,</span> train_y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>test_x<span class=\"token punctuation\">,</span> test_y<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> mnist<span class=\"token punctuation\">.</span>load_data<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ntrain_x <span class=\"token operator\">=</span> train_x <span class=\"token operator\">/</span> <span class=\"token number\">255.0</span>\ntest_x <span class=\"token operator\">=</span> test_x <span class=\"token operator\">/</span> <span class=\"token number\">255.0</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">build_model</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    model <span class=\"token operator\">=</span> tf<span class=\"token punctuation\">.</span>keras<span class=\"token punctuation\">.</span>Sequential<span class=\"token punctuation\">(</span>\n        <span class=\"token punctuation\">[</span>\n            tf<span class=\"token punctuation\">.</span>keras<span class=\"token punctuation\">.</span>layers<span class=\"token punctuation\">.</span>Flatten<span class=\"token punctuation\">(</span>input_shape<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token number\">28</span><span class=\"token punctuation\">,</span> <span class=\"token number\">28</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            tf<span class=\"token punctuation\">.</span>keras<span class=\"token punctuation\">.</span>layers<span class=\"token punctuation\">.</span>Dense<span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">,</span> activation<span class=\"token operator\">=</span><span class=\"token string\">'relu'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            tf<span class=\"token punctuation\">.</span>keras<span class=\"token punctuation\">.</span>layers<span class=\"token punctuation\">.</span>Dense<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> activation<span class=\"token operator\">=</span><span class=\"token string\">'softmax'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">)</span>\n    model<span class=\"token punctuation\">.</span><span class=\"token builtin\">compile</span><span class=\"token punctuation\">(</span>\n        optimizer<span class=\"token operator\">=</span><span class=\"token string\">'adam'</span><span class=\"token punctuation\">,</span>\n        loss<span class=\"token operator\">=</span><span class=\"token string\">'sparse_categorical_crossentropy'</span><span class=\"token punctuation\">,</span>\n        metrics<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'accuracy'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> model\n\nmodel <span class=\"token operator\">=</span> build_model<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># train</span>\nmodel<span class=\"token punctuation\">.</span>fit<span class=\"token punctuation\">(</span>train_x<span class=\"token punctuation\">,</span> train_y<span class=\"token punctuation\">,</span> epochs<span class=\"token operator\">=</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># evaluate</span>\nloss<span class=\"token punctuation\">,</span> acc <span class=\"token operator\">=</span> model<span class=\"token punctuation\">.</span>evaluate<span class=\"token punctuation\">(</span>test_x<span class=\"token punctuation\">,</span> test_y<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"loss : {:.4f} acc : {:.4f}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>loss<span class=\"token punctuation\">,</span> acc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># save</span>\nmodel<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token string\">\"gs://suwan_test/20211027/model\"</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<hr>\n<h2 id=\"2-도커-컨테이너로-패키징하기\" style=\"position:relative;\"><a href=\"#2-%EB%8F%84%EC%BB%A4-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88%EB%A1%9C-%ED%8C%A8%ED%82%A4%EC%A7%95%ED%95%98%EA%B8%B0\" aria-label=\"2 도커 컨테이너로 패키징하기 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 도커 컨테이너로 패키징하기</h2>\n<p>Vertex AI에서 학습시 학습의 위한 코드가 패키징된 커스텀 컨테이너를 요구한다. 커스텀 컨테이너틑 google container registry 즉, gcr에 올라가 있어야 한다. 당연히 <code class=\"language-text\">Dockerfile</code> 을 생성하는 것부터 시작한다.</p>\n<h4 id=\"dockerfile\" style=\"position:relative;\"><a href=\"#dockerfile\" aria-label=\"dockerfile permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dockerfile</h4>\n<p>이미지 태그를 적어주지 않으면 latest를 가져오는데 mnist 모델 학습에 문제되지 않을거라 판단하여 지정하지 않았다.</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"><code class=\"language-dockerfile\"><span class=\"token keyword\">FROM</span> tensorflow/tensorflow\n\n<span class=\"token keyword\">ADD</span> train.py /\n\n<span class=\"token keyword\">ENTRYPOINT</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"python\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"train.py\"</span> <span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id=\"build--push\" style=\"position:relative;\"><a href=\"#build--push\" aria-label=\"build  push permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Build &#x26; Push</h4>\n<p>gcr에 도커 컨테이너를 배포하는 것은 간단하다!!</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token assign-left variable\">IMAGE_URI</span><span class=\"token operator\">=</span><span class=\"token string\">\"gcr.io/<span class=\"token variable\">$PROJECT_ID</span>/mnist_model:20211027\"</span>\ndocker build ./ -t <span class=\"token variable\">$IMAGE_URI</span> <span class=\"token comment\"># Build</span>\ndocker push <span class=\"token variable\">$IMAGE_URI</span> <span class=\"token comment\"># Push</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Container Registry에 접속해보면 다음과 같이 컨테이너가 잘 올라가 있는걸 확인할 수 있다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/ea1280edacf215fff465d55653c8f2d2/1a867/gcr.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 39.361702127659576%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABA0lEQVQoz31S2W6EMBDj//8OXnjhBbEcBcSViyvx4rRpdyW2I1mZmUwcx0pUNw26rkNzrcXjASkFtt1iWQSEEFBKXT2J8zxxHIfHvu8fETXDhq8LwjgPtQJKG3Rt6wlDvB5yzuFTRNqskErDWgf7MyilwjAMmKbJK2KM4+jreZ7/J/xL3e8gn0mQTGuNbdu+J6599tZ1fVMcatoScegVjL7vkaYp8jz3ikhYVZX3sr2sqOvaX0TvaQv9N8b43i0hh5IkQZZl/pnsk5QKSMrcWutzKiMRayq9JVyWBXEcvxEG8DKqITlzkodfwP4tITeKokBZlt5L9qmAa/CUNeeCp6yp9gmHTW7oagO74QAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"gcr\" title=\"gcr\" src=\"/static/ea1280edacf215fff465d55653c8f2d2/1d69c/gcr.png\" srcset=\"/static/ea1280edacf215fff465d55653c8f2d2/4dcb9/gcr.png 188w,\n/static/ea1280edacf215fff465d55653c8f2d2/5ff7e/gcr.png 375w,\n/static/ea1280edacf215fff465d55653c8f2d2/1d69c/gcr.png 750w,\n/static/ea1280edacf215fff465d55653c8f2d2/78797/gcr.png 1125w,\n/static/ea1280edacf215fff465d55653c8f2d2/aa440/gcr.png 1500w,\n/static/ea1280edacf215fff465d55653c8f2d2/1a867/gcr.png 1998w\" sizes=\"(max-width: 750px) 100vw, 750px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span>\n<hr>\n<h2 id=\"3-vertex-ai에-train-job-생성하기\" style=\"position:relative;\"><a href=\"#3-vertex-ai%EC%97%90-train-job-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0\" aria-label=\"3 vertex ai에 train job 생성하기 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Vertex AI에 Train JOB 생성하기</h2>\n<h4 id=\"1-train-pipeline-만들기\" style=\"position:relative;\"><a href=\"#1-train-pipeline-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"1 train pipeline 만들기 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Train Pipeline 만들기</h4>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/5f822f331372b3b65222c08dd69f8901/d9ed5/make_train.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 23.936170212765955%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAtklEQVQY042QyQ7CMAxE8///1xtnDjRJs9Ds7eAJcEEIYenJyjie2FHWWozeUWvDbd1wXS6wy4LiNzTR931HSknqFWMMdNE+GaMjlYZ7alC8zBjHAesTjA2I3sMLMUZ45+CE1tq8d57nV6QyUc55HGJGtF6hV8EYrJKN5JumeZyT/DZ8hoohTIGGnIgrcj2C17v/BPv5qNpCRZLePXcEMX//GYtcs5YyzanxzFxEIzyTnPMchv0PAqCGdOnTKG8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"make train\" title=\"make train\" src=\"/static/5f822f331372b3b65222c08dd69f8901/1d69c/make_train.png\" srcset=\"/static/5f822f331372b3b65222c08dd69f8901/4dcb9/make_train.png 188w,\n/static/5f822f331372b3b65222c08dd69f8901/5ff7e/make_train.png 375w,\n/static/5f822f331372b3b65222c08dd69f8901/1d69c/make_train.png 750w,\n/static/5f822f331372b3b65222c08dd69f8901/78797/make_train.png 1125w,\n/static/5f822f331372b3b65222c08dd69f8901/aa440/make_train.png 1500w,\n/static/5f822f331372b3b65222c08dd69f8901/d9ed5/make_train.png 2880w\" sizes=\"(max-width: 750px) 100vw, 750px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span>\n<h4 id=\"2-train-pipeline-configure\" style=\"position:relative;\"><a href=\"#2-train-pipeline-configure\" aria-label=\"2 train pipeline configure permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Train Pipeline Configure</h4>\n<ol>\n<li>학습방법\nDataset: <strong>관리형 데이터셋 없음</strong> - 코드 내에서 load_data()를 통해 데이터를 불러온다.</li>\n<li>모델 세부정보\nModel name: 알아서 아무거나 하면된다. 나는 <strong>mnist_train</strong></li>\n<li>\n<p>학습 컨테이너</p>\n<ol>\n<li><strong>커스텀 컨테이너</strong></li>\n<li><strong>컨테이너 이미지</strong>: Docker Push 한 경로를 찾아 선택하면 된다.\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/186510176d0fc62f184bf617d37baae0/75a80/select_gcr.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 32.97872340425532%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABF0lEQVQoz4WQbUvDMBSF8///jYwp4rSg+ElEtg91c+7NrC9r17e0TdKm6THLGAhSvfCQ3Av3cM4lH4s5vnZb7PfUvpvNGuHhgKHq+/5nZ/vLLGUKhJUChYFV0lLWElp3UEqhrmsIIcA5t5xmp2Wt9S/6XkN1GuTTa/G+k1jQM8u9RCU6SCkQBAHiOMbBOA7D0IoPCV5ECaUUeZYiTRIczbL9Fy2ath+M/BeEsQJ5WSIrcqR5ZmKXxmEL3hqXqrWuTrc683+RvGoQzqZYTSZYPjhYOQ7mt2O41yNsHh34fgQuNWpzhiG47IwRZZI1IF4k4N8bEecV7tMMy+cp3m4meBnfYXU1QkQTeImCF8tBgmODrc/hrhm+AQqAF5wfMjl2AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"select gcr\" title=\"select gcr\" src=\"/static/186510176d0fc62f184bf617d37baae0/1d69c/select_gcr.png\" srcset=\"/static/186510176d0fc62f184bf617d37baae0/4dcb9/select_gcr.png 188w,\n/static/186510176d0fc62f184bf617d37baae0/5ff7e/select_gcr.png 375w,\n/static/186510176d0fc62f184bf617d37baae0/1d69c/select_gcr.png 750w,\n/static/186510176d0fc62f184bf617d37baae0/78797/select_gcr.png 1125w,\n/static/186510176d0fc62f184bf617d37baae0/75a80/select_gcr.png 1134w\" sizes=\"(max-width: 750px) 100vw, 750px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span></li>\n<li>gs 경로 <code class=\"language-text\">1. Train.py</code> 에서 model save 했던 경로를 선택해주면 된다. 나의 경우 <strong>gs://suwan_test/20211027/model</strong></li>\n</ol>\n</li>\n<li>초매개변수\n선택하지 않음</li>\n<li>\n<p>컴퓨팅 및 가격 책정</p>\n<p>가장 저렴한 인스턴스인 <strong>n1-standard-4, 4 vCPUs, 15GiB memory</strong> 를 선택했다.</p>\n</li>\n<li>\n<p>예측 컨테이너\nPrediction을 위한 컨테이너를 생성해주는 부분이다.\n<strong>Pre-built container</strong>\nFramework: <strong>Tensorflow</strong></p>\n<p>Version: <strong>2.6</strong> Latest\nGPU: None\nModel Directory: 모델이 저장될 경로를 선택해주면 된다. 위에서의 gs 경로와 동일하다. <strong>gs://suwan_test/20211027/model</strong></p>\n</li>\n</ol>\n<h4 id=\"3-학습시작\" style=\"position:relative;\"><a href=\"#3-%ED%95%99%EC%8A%B5%EC%8B%9C%EC%9E%91\" aria-label=\"3 학습시작 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 학습시작</h4>\n<p>이제 학습을 시작하면 된다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/4f5a133dc5223bb7883c41e735d291cf/569c6/train_button.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 81.38297872340425%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACHklEQVQ4y41TS7LTMBD0qVlyDM7BghO8HXugWMBLHvlYjiRL/kryr5mZJK4kRQBXukaxPK3umVFmbInNZoPD4YDtdotpmsDPsiyo6xrWWkFZljDGwFgHbRxFv0bnK8zzLHnZryJhf9SUYISMia4wRiPPc4FSBSVbGNdDuyAoLMeIrk9rTrZVCXlR4lQopDSs6hh9CDidTtBak0pD+xEDY7iA1ikFUnd2JQqZ8KgsJRaIMa5kM6GskhCetIVvEtowk5qIvu/vEAgxBnGYvamIQ25QkgLvPZ08XM5a0DQtClJ+zBWsa9F0AxEEBFIeIq0JIY7ndRiIcEb2U03Yk+WCbKlCi4KRHMRhFvKu64ikE7vjkCSG0KPpR7hmgm8nVN0k62mmGn77bvDl6wH7txy2CjCePg4LtB/XznLkTrN9Vvf8IcKPHz7h3fsX/Hj5DEzx8n6RzTw/YvP6itcb8GgppQRHpcmZl6YW2snoZB1t+H2Owbu7kWEUhmpoW/Rku2kasd+2rcwnR65p1bL1gdbjeWzuBD8QOmpSTg3hZlVVBeeckDH4f13ze1I2jWt+tpBMwQMZP2Vp5RbxaLCdcRxlNB7Be9xAGZtHoltCVsINYYWc9DdcD3tKyJA6Ue1ulT0j/D+FUqf6rsZ/Irvm/Fsh3VMm3O12dGMKmcH1ahLRVXFKSeaUnTxXSL+y8bDleaAZXMte7m28U8d2eQJG6vZvM6XXL9JAqUAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"train button\" title=\"train button\" src=\"/static/4f5a133dc5223bb7883c41e735d291cf/1d69c/train_button.png\" srcset=\"/static/4f5a133dc5223bb7883c41e735d291cf/4dcb9/train_button.png 188w,\n/static/4f5a133dc5223bb7883c41e735d291cf/5ff7e/train_button.png 375w,\n/static/4f5a133dc5223bb7883c41e735d291cf/1d69c/train_button.png 750w,\n/static/4f5a133dc5223bb7883c41e735d291cf/78797/train_button.png 1125w,\n/static/4f5a133dc5223bb7883c41e735d291cf/aa440/train_button.png 1500w,\n/static/4f5a133dc5223bb7883c41e735d291cf/569c6/train_button.png 1674w\" sizes=\"(max-width: 750px) 100vw, 750px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span>\n<hr>\n<h2 id=\"4-배포-및-서빙\" style=\"position:relative;\"><a href=\"#4-%EB%B0%B0%ED%8F%AC-%EB%B0%8F-%EC%84%9C%EB%B9%99\" aria-label=\"4 배포 및 서빙 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 배포 및 서빙</h2>\n<p>3에서 학습을 시작했으니까 조금 기다리면 아래와 같이 학습이 종료된 걸 확인할 수 있을 것이다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6540aae5344dbf9f16e0f69568566668/bc81a/train.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 37.23404255319149%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABAklEQVQoz61RXWvDMAz0//+Dg0Fpm6RNmsSx6287tm+Ky/a0jT1MIMQJ6biTmDEGUkocEdMOLi1WVWB9QikZKSWE4CkD4YJa67eZ87GTwbz3iDE2wpQypllg5QLbtoFzDiEIrxxKqR/JPhOoYM7Zr+Gcd6zLDLHxRijERuoVNmmayvqLwhchwLRxEPJJdoiQeo7Uhp2sltfAX6M2hwlM6AjtdsQCqHnB+v4G1Z0hLyfY4Qp76yCvJ5j+0voH1lQPfFR37+Gop4auuWIxhsbcnvKUbSktD6ieyMYBYRkhhzPC4w5Dy3GZ4KYbPGFNRGEekeYJkS90MnqKtRZaa/xHHHf8AHmtH+ecVrMqAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"train\" title=\"train\" src=\"/static/6540aae5344dbf9f16e0f69568566668/1d69c/train.png\" srcset=\"/static/6540aae5344dbf9f16e0f69568566668/4dcb9/train.png 188w,\n/static/6540aae5344dbf9f16e0f69568566668/5ff7e/train.png 375w,\n/static/6540aae5344dbf9f16e0f69568566668/1d69c/train.png 750w,\n/static/6540aae5344dbf9f16e0f69568566668/78797/train.png 1125w,\n/static/6540aae5344dbf9f16e0f69568566668/aa440/train.png 1500w,\n/static/6540aae5344dbf9f16e0f69568566668/bc81a/train.png 2862w\" sizes=\"(max-width: 750px) 100vw, 750px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span>\n<p>그리고 모델 탭이 가면 모델이 등록되어 있는 것도 확인할 수 있는 것이다. 이는  Train Pipeline Configure -> 예측 컨테이너를 설정해줬기 때문에 생성된 것이다.  </p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6621e9f9c7587ac72d126b705488f813/d9ed5/model.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 23.404255319148938%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAzklEQVQY05VQ266CMBDk//9QT8AgIqJC2u629AZztn3wzQc3mUw6nUx32iilkHNGEjjLWLWH4QB2ATFGpJQqimff96/IeQdvCY21FmUOEYkIRiswGWhhEiZNoJURQ8BxHF8hCTWn0VrXF8rROge2Dl42C7LVr1NymrJFCUveYx168PMBnh/YlleFfc0f9uu7Yns/4YsmXjONiCzNpN2yLFKZuaYnMZn2hDjfEaYB1HdwYw9zbRGnW9XSPMLfB9jhAtWeQdcOpvurd7n+Y8Y/FgWDk21thzIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"model\" title=\"model\" src=\"/static/6621e9f9c7587ac72d126b705488f813/1d69c/model.png\" srcset=\"/static/6621e9f9c7587ac72d126b705488f813/4dcb9/model.png 188w,\n/static/6621e9f9c7587ac72d126b705488f813/5ff7e/model.png 375w,\n/static/6621e9f9c7587ac72d126b705488f813/1d69c/model.png 750w,\n/static/6621e9f9c7587ac72d126b705488f813/78797/model.png 1125w,\n/static/6621e9f9c7587ac72d126b705488f813/aa440/model.png 1500w,\n/static/6621e9f9c7587ac72d126b705488f813/d9ed5/model.png 2880w\" sizes=\"(max-width: 750px) 100vw, 750px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span>\n<p>모델이름 클릭하면 세부 정보를 확인할 수 있다. 배포를 위해선 엔드포인트가 필요하고 없으면 생성해야한다. </p>\n<p>새 엔드포인트 만들기를 선택하고 적절한 이름을 짓자. 그리고 머신유형만 선택하면된다. 나의 경우 가장 저렴한 인스턴스인 <strong>n1-standard-4, 4 vCPUs, 15GiB memory</strong> 를 선택했다. </p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6b466fa5c8b6844a6ef733d67242ae88/b6425/model2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 39.361702127659576%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA+ElEQVQoz5VR20rDQBDd//8EX/wSxTcfBIVWsRT0IUGaNE33lm32muNOSmxEkGbgMLNnhzNnZ5k+BewPAm3bwjmPo7QIIWIYBqSUxrwETBkPfUrwPiDFLJTOYvNYJGiMAj9WaA57dMbAWou+70dMdcyDrhVmH2+fuL9bY7vaQkkOzgWEuKDruj+O/wv29LDGze0zVo+bfIwI2Q05mvJYh/ADcu29/8UTR5k4hmgBJxGdgZQqO9L5c1xuOj/Z5DVMKyBIKUfX1DPnKBPHRBYpv3Z4eX2fTU+I6bKXJcGUUiiKAkVZoq5rVNUOdcNRNQpaa9A9Dbn2U74BFmFv+i2Q9ZEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"model2\" title=\"model2\" src=\"/static/6b466fa5c8b6844a6ef733d67242ae88/1d69c/model2.png\" srcset=\"/static/6b466fa5c8b6844a6ef733d67242ae88/4dcb9/model2.png 188w,\n/static/6b466fa5c8b6844a6ef733d67242ae88/5ff7e/model2.png 375w,\n/static/6b466fa5c8b6844a6ef733d67242ae88/1d69c/model2.png 750w,\n/static/6b466fa5c8b6844a6ef733d67242ae88/78797/model2.png 1125w,\n/static/6b466fa5c8b6844a6ef733d67242ae88/aa440/model2.png 1500w,\n/static/6b466fa5c8b6844a6ef733d67242ae88/b6425/model2.png 2336w\" sizes=\"(max-width: 750px) 100vw, 750px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span>\n<p>엔드포인트 배포를 선택하면 시간이 좀 걸리는데 이후에 엔드포인트 탭으로 이동하면 다음과 같이 잘 생성된 것을 확인할 수 있다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/392c4f529b9258182a62f55991a0295c/93ba6/endpoint.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 37.765957446808514%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABEUlEQVQoz6WR2U4DMQxF8/+/hwQSVC0tdB062Sb7cnFCmZbywAOWjjxz4zi+CeOcI+eMlBL4OEJPFgN30CYgxohEhBD6eiml195TSoYPGcYlMGstWtRa0ZoLwaG1hFISUioIqSlLOOfmultImXODCSH6ybUWaqQxEd55GDPRZBHWtzVcN94xa5dgSqkuFtIENdM0sSObsVyLynz+13cj3+nNgTEGzF+sRLJ5eHwAXy2gNiuo9RKSGF8XMO8bYt217zw8P8FuN5DLF9jzANWGoeGYJXvthEQW43GHeNojDYeeY8tE+/eHbdfyx7FrgWrz+QS/f0PWar5fNsoAFypCxr+iXu6RTZO+eb3y6xX/5ueeT3eycGHDWbj/AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"endpoint\" title=\"endpoint\" src=\"/static/392c4f529b9258182a62f55991a0295c/1d69c/endpoint.png\" srcset=\"/static/392c4f529b9258182a62f55991a0295c/4dcb9/endpoint.png 188w,\n/static/392c4f529b9258182a62f55991a0295c/5ff7e/endpoint.png 375w,\n/static/392c4f529b9258182a62f55991a0295c/1d69c/endpoint.png 750w,\n/static/392c4f529b9258182a62f55991a0295c/78797/endpoint.png 1125w,\n/static/392c4f529b9258182a62f55991a0295c/aa440/endpoint.png 1500w,\n/static/392c4f529b9258182a62f55991a0295c/93ba6/endpoint.png 2874w\" sizes=\"(max-width: 750px) 100vw, 750px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span>\n<p>엔드포인트 이름을 클릭하면 세부정보를 확인할 수 있다. 엔드포인트 어떤 모델이 연결되어 있는지부터 예측/초, 예측 오차율, 요청/초, 총 지연시간 길이, 모델 지연시간 길이 등을 차트 간격(1시간, 6시간, 12시간, 1일, ~ 30일)으로 확인할 수 있다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/51a8af728eb07da42ed1352efdb90c8f/d438d/endpoint2.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABTklEQVQ4y6VTi27DMAj0///lpLXq0qRJ/H7fwEnTNKq0dUM6YbAB+8AipgIpJa7XK7xz8LHC+tzAe0BFKRW1PoPl6GOIGDy893hIXVWF8xEpVxwlpYR5nhFjfPK3hLNy6PsbAiVOdIAPO7op27dRQRsHa00rqrUif4BSiuzFzzHW2hbDseI8JJw6g36yGDVV1gWnfsbXoDHMlFQGnDuiZLS49ArD5PFx6mkvkK0pzuHzMra9m4z05FQxmQLjK/GHDY51WvQdi5+oCCtWv7aJ4ktbi1IylKZm+EAcFJScCQmV/Jn0wulPePAvfKBnSkVd7ogj3bgw5s6ZpqSZ+/Oyoy+7PElNxPutS0f5baItoTG6dewvweVg82vEOnI0vOXtRIH5XuNY80iJd2+1R8hl+0VbQq7GA5nXanvsfa/WrPdr/jlCUTfnNvke/7ntHd+OQv+NWRQoLAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"endpoint2\" title=\"endpoint2\" src=\"/static/51a8af728eb07da42ed1352efdb90c8f/1d69c/endpoint2.png\" srcset=\"/static/51a8af728eb07da42ed1352efdb90c8f/4dcb9/endpoint2.png 188w,\n/static/51a8af728eb07da42ed1352efdb90c8f/5ff7e/endpoint2.png 375w,\n/static/51a8af728eb07da42ed1352efdb90c8f/1d69c/endpoint2.png 750w,\n/static/51a8af728eb07da42ed1352efdb90c8f/78797/endpoint2.png 1125w,\n/static/51a8af728eb07da42ed1352efdb90c8f/aa440/endpoint2.png 1500w,\n/static/51a8af728eb07da42ed1352efdb90c8f/d438d/endpoint2.png 2290w\" sizes=\"(max-width: 750px) 100vw, 750px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span>\n<hr>\n<h2 id=\"5-test\" style=\"position:relative;\"><a href=\"#5-test\" aria-label=\"5 test permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. Test</h2>\n<p>엔드포인트가 생성되었으니 잘 동작하는지 확인해보자. 모델의 세부 정보에 들어가면 모델 테스트를 할 수 있다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/cdd9c97dee7ef65f5332a55cf6cf6a81/fd561/model_test.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 51.59574468085106%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABg0lEQVQoz3WSaWocMRCF+/4H8SlyB4MxMYTkhxfGM71r3/VSJfXYY4NFf5RKy1NJrwdjDIQQqLUg5QprLIwWUMY3Sik3VJT6SeVYOr1fMDjn4L0HN6Ej7n5d8PBXUpaRc0LJPfKBIGr5pJTcxpnerxi4QillS2LK+PNP4DRaErfYlcOqaN4Ewreco7KB5j3O00ZjnEeswkAb1wX3faeKeulGBWgZsCyms2qsq8E0Scyzav11tW1uHAUuo279bffQNvGVPWKM7cphW/H6+xFP9/eQpzeo8+ngHfpyhptG4tKZmSOnGKczqtUYhE7QLoM+2HGCoGo3qeg0e0BXpbcVht4RP7cayEAlMGitm8vc0rbASPltZe2QXEoJIYTDhAMyrfBerZBZkBddXc77AqsUHOW5uZvbpuYqiXLOf8V3PB2i5glJ7Bg+CjkEkSMibUwMuX47z6bxYZZEvuAD7L4hSRJkQ64V+mXG88uGQlXXFBslXgnIVEl0FsHeYhBpv6fnyiT4HynDCZMh4jmdAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"model test\" title=\"model test\" src=\"/static/cdd9c97dee7ef65f5332a55cf6cf6a81/1d69c/model_test.png\" srcset=\"/static/cdd9c97dee7ef65f5332a55cf6cf6a81/4dcb9/model_test.png 188w,\n/static/cdd9c97dee7ef65f5332a55cf6cf6a81/5ff7e/model_test.png 375w,\n/static/cdd9c97dee7ef65f5332a55cf6cf6a81/1d69c/model_test.png 750w,\n/static/cdd9c97dee7ef65f5332a55cf6cf6a81/78797/model_test.png 1125w,\n/static/cdd9c97dee7ef65f5332a55cf6cf6a81/aa440/model_test.png 1500w,\n/static/cdd9c97dee7ef65f5332a55cf6cf6a81/fd561/model_test.png 2866w\" sizes=\"(max-width: 750px) 100vw, 750px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span>\n<p>모델 테스트를 위해 JSON 요청을 보낼 수 있는데 각 인스턴스를 JSON 배열의 항목으로 만들고 배열을 JSON 객체의 <code class=\"language-text\">instances</code> 필드로 데이터를 제공해야 한다. </p>\n<p>그러니까 instances 라는 key의 value로 mnist 데이터를 줘야한다. test 이미지를 하나 넣기 위해 다시 MNIST 데이터를 불러와보자</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">import</span> tensorflow <span class=\"token keyword\">as</span> tf\n\n<span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">,</span> _<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>test_x<span class=\"token punctuation\">,</span> test_y<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> tf<span class=\"token punctuation\">.</span>keras<span class=\"token punctuation\">.</span>datasets<span class=\"token punctuation\">.</span>mnist<span class=\"token punctuation\">.</span>load_data<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ntest_x <span class=\"token operator\">=</span> test_x <span class=\"token operator\">/</span> <span class=\"token number\">255.0</span>\n\ntest_x<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>tolist<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>나오는 결과를 넣어 JSON을 완성하면 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-json line-numbers\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"instances\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">[</span>\n        <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n        <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n        ...\n        <span class=\"token number\">0</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      ...\n      <span class=\"token punctuation\">[</span>\n        <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n        <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n        ...\n        <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>내가 받은 응답은 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-json line-numbers\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n <span class=\"token property\">\"predictions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n   <span class=\"token punctuation\">[</span>\n     <span class=\"token number\">0.00000536688867</span><span class=\"token punctuation\">,</span>\n     <span class=\"token number\">2.52842867e-8</span><span class=\"token punctuation\">,</span>\n     <span class=\"token number\">0.000187751983</span><span class=\"token punctuation\">,</span>\n     <span class=\"token number\">0.00154095062</span><span class=\"token punctuation\">,</span>\n     <span class=\"token number\">6.33089892e-9</span><span class=\"token punctuation\">,</span>\n     <span class=\"token number\">0.0000025349284</span><span class=\"token punctuation\">,</span>\n     <span class=\"token number\">3.57508412e-10</span><span class=\"token punctuation\">,</span>\n     <span class=\"token number\">0.99822706</span><span class=\"token punctuation\">,</span> # <span class=\"token number\">7</span>\n     <span class=\"token number\">0.0000055970122</span><span class=\"token punctuation\">,</span>\n     <span class=\"token number\">0.0000307485061</span>\n   <span class=\"token punctuation\">]</span>\n <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n <span class=\"token property\">\"deployedModelId\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"4307737024044990464\"</span><span class=\"token punctuation\">,</span>\n <span class=\"token property\">\"model\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"projects/697793444829/locations/us-central1/models/4193418601081864192\"</span><span class=\"token punctuation\">,</span>\n <span class=\"token property\">\"modelDisplayName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mnist_train\"</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6384febebaf0da22199bdf880924a9c1/f0293/result.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 37.765957446808514%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA6UlEQVQoz42SQWvDMAyF/f//VC87jbLbYIfRbtA1lJSR2LFlx7berKQuWVu2CB4yIu+zJEftdns8PW9hhgHOOVhrSyYMlkrNwVGABDOvkiIieO8xFKDWuqiHNg7fvce5I3RGgLwaqmKM+C9yzkgpzdALfBkCqqHatoVAxXQvnnIIAbrvEX1AHEeMNxJ/XZeSg4wtxkcjSF0M1hh8NQccz6eyXzsBlrKXmuKcpltuW7+Ogxlqy8evzQfemk/UJhzNuUreQpGPZSR/7YZ5Vu247k8M76cD9u3xF2QpWY3avHRTJynz6l/jL/0AWlpzJXL6JFoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"result\" title=\"result\" src=\"/static/6384febebaf0da22199bdf880924a9c1/1d69c/result.png\" srcset=\"/static/6384febebaf0da22199bdf880924a9c1/4dcb9/result.png 188w,\n/static/6384febebaf0da22199bdf880924a9c1/5ff7e/result.png 375w,\n/static/6384febebaf0da22199bdf880924a9c1/1d69c/result.png 750w,\n/static/6384febebaf0da22199bdf880924a9c1/78797/result.png 1125w,\n/static/6384febebaf0da22199bdf880924a9c1/aa440/result.png 1500w,\n/static/6384febebaf0da22199bdf880924a9c1/f0293/result.png 2250w\" sizes=\"(max-width: 750px) 100vw, 750px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n  </a>\n    </span>\n<h4 id=\"파이썬에서-예측을-수행해보자\" style=\"position:relative;\"><a href=\"#%ED%8C%8C%EC%9D%B4%EC%8D%AC%EC%97%90%EC%84%9C-%EC%98%88%EC%B8%A1%EC%9D%84-%EC%88%98%ED%96%89%ED%95%B4%EB%B3%B4%EC%9E%90\" aria-label=\"파이썬에서 예측을 수행해보자 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>파이썬에서 예측을 수행해보자</h4>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> google<span class=\"token punctuation\">.</span>cloud <span class=\"token keyword\">import</span> aiplatform\n\nendpoint <span class=\"token operator\">=</span> aiplatform<span class=\"token punctuation\">.</span>Endpoint<span class=\"token punctuation\">(</span>\n    endpoint_name<span class=\"token operator\">=</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"projects/</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>PROJECT_ID<span class=\"token punctuation\">}</span></span><span class=\"token string\">/locations/us-central1/endpoints/</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>ENDPOINT_ID<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">import</span> tensorflow <span class=\"token keyword\">as</span> tf\n\n<span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">,</span> _<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>test_x<span class=\"token punctuation\">,</span> test_y<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> tf<span class=\"token punctuation\">.</span>keras<span class=\"token punctuation\">.</span>datasets<span class=\"token punctuation\">.</span>mnist<span class=\"token punctuation\">.</span>load_data<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ntest_x <span class=\"token operator\">=</span> test_x <span class=\"token operator\">/</span> <span class=\"token number\">255.0</span>\none_image <span class=\"token operator\">=</span> test_x<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n\nresponse <span class=\"token operator\">=</span> endpoint<span class=\"token punctuation\">.</span>predict<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>one_image<span class=\"token punctuation\">.</span>tolist<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"real : {}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>test_y<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"predicted : {}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>argmax<span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>predictions<span class=\"token punctuation\">,</span> axis<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token comment\"># real : 7</span>\n<span class=\"token comment\"># predicted : 7</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","tableOfContents":"<ul>\n<li><a href=\"/category/blog/mlops/mnist_training_vertex/#1-trainpy-%ED%8C%8C%EC%9D%BC-%EB%A7%8C%EB%93%A4%EA%B8%B0\">1. train.py 파일 만들기</a></li>\n<li>\n<p><a href=\"/category/blog/mlops/mnist_training_vertex/#2-%EB%8F%84%EC%BB%A4-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88%EB%A1%9C-%ED%8C%A8%ED%82%A4%EC%A7%95%ED%95%98%EA%B8%B0\">2. 도커 컨테이너로 패키징하기</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"/category/blog/mlops/mnist_training_vertex/#dockerfile\">Dockerfile</a></li>\n<li><a href=\"/category/blog/mlops/mnist_training_vertex/#build--push\">Build &#x26; Push</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"/category/blog/mlops/mnist_training_vertex/#3-vertex-ai%EC%97%90-train-job-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0\">3. Vertex AI에 Train JOB 생성하기</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"/category/blog/mlops/mnist_training_vertex/#1-train-pipeline-%EB%A7%8C%EB%93%A4%EA%B8%B0\">1. Train Pipeline 만들기</a></li>\n<li><a href=\"/category/blog/mlops/mnist_training_vertex/#2-train-pipeline-configure\">2. Train Pipeline Configure</a></li>\n<li><a href=\"/category/blog/mlops/mnist_training_vertex/#3-%ED%95%99%EC%8A%B5%EC%8B%9C%EC%9E%91\">3. 학습시작</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"/category/blog/mlops/mnist_training_vertex/#4-%EB%B0%B0%ED%8F%AC-%EB%B0%8F-%EC%84%9C%EB%B9%99\">4. 배포 및 서빙</a></li>\n<li>\n<p><a href=\"/category/blog/mlops/mnist_training_vertex/#5-test\">5. Test</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"/category/blog/mlops/mnist_training_vertex/#%ED%8C%8C%EC%9D%B4%EC%8D%AC%EC%97%90%EC%84%9C-%EC%98%88%EC%B8%A1%EC%9D%84-%EC%88%98%ED%96%89%ED%95%B4%EB%B3%B4%EC%9E%90\">파이썬에서 예측을 수행해보자</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"[MLOps] Vertex AI에서 MNIST 학습, 배포, 서빙","description":"","date":"2021.10.27","emoji":"🏋️","category":"blog"}}},"pageContext":{"slug":"/category/blog/mlops/mnist_training_vertex/","relatedPosts":[{"node":{"fields":{"slug":"/category/blog/interview/"},"frontmatter":{"title":"[면접준비] minimum 질문&답변","date":"2021.11.22","emoji":"❓","category":"blog"}}},{"node":{"fields":{"slug":"/category/blog/hackerrank_certification/"},"frontmatter":{"title":"해커랭크 인증서 발급 후기","date":"2021.11.19","emoji":"📚","category":"blog"}}},{"node":{"fields":{"slug":"/category/blog/m1-tensorflow/"},"frontmatter":{"title":"[Tensorflow] M1에서 Tensorflow GPU 사용하기 (Monterey)","date":"2021.11.13","emoji":"💪","category":"blog"}}},{"node":{"fields":{"slug":"/category/blog/effective-python/"},"frontmatter":{"title":"[책] 파이썬 코딩의 기술","date":"2021.11.02","emoji":"📚","category":"blog"}}},{"node":{"fields":{"slug":"/category/blog/mlops/simple_model_deploy_mnist/"},"frontmatter":{"title":"[MLOps] Vertex AI에서 모델 배포하기 (MNIST)","date":"2021.11.01","emoji":"🏃","category":"blog"}}}]}}}