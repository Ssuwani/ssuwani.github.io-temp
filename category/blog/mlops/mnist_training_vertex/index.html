<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.1cfadd536e0ed4ee026c.css">pre[class*=language-].line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:0;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-ms-user-select:none;user-select:none}.line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}</style><meta name="generator" content="Gatsby 2.23.3"/><link rel="icon" href="/favicon-32x32.png?v=83455313757f7d5558ecbb4d2c6744cf"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#0c9ee4"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=83455313757f7d5558ecbb4d2c6744cf"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=83455313757f7d5558ecbb4d2c6744cf"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=83455313757f7d5558ecbb4d2c6744cf"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=83455313757f7d5558ecbb4d2c6744cf"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=83455313757f7d5558ecbb4d2c6744cf"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=83455313757f7d5558ecbb4d2c6744cf"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=83455313757f7d5558ecbb4d2c6744cf"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=83455313757f7d5558ecbb4d2c6744cf"/><style type="text/css">
    .anchor-header.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor-header.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor-header svg,
    h2 .anchor-header svg,
    h3 .anchor-header svg,
    h4 .anchor-header svg,
    h5 .anchor-header svg,
    h6 .anchor-header svg {
      visibility: hidden;
    }
    h1:hover .anchor-header svg,
    h2:hover .anchor-header svg,
    h3:hover .anchor-header svg,
    h4:hover .anchor-header svg,
    h5:hover .anchor-header svg,
    h6:hover .anchor-header svg,
    h1 .anchor-header:focus svg,
    h2 .anchor-header:focus svg,
    h3 .anchor-header:focus svg,
    h4 .anchor-header:focus svg,
    h5 .anchor-header:focus svg,
    h6 .anchor-header:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><title data-react-helmet="true">[MLOps] Vertex AI에서 MNIST 학습, 배포, 서빙 | 어서OpShow</title><link data-react-helmet="true" rel="canonical" href="https://ssuwani.github.io/category/blog/mlops/mnist_training_vertex/"/><meta data-react-helmet="true" name="description" content="조대협님의 블로그를 참고했습니다! 감사합니다.  https://bcho.tistory.com/1383 구글에서 제공하는 통합 머신러닝 플랫폼인 Vertex AI를 이용해서 MNIST 데이터를 학습하고 모델을 배포하고 Endpoint…"/><meta data-react-helmet="true" property="og:title" content="[MLOps] Vertex AI에서 MNIST 학습, 배포, 서빙"/><meta data-react-helmet="true" property="og:description" content="조대협님의 블로그를 참고했습니다! 감사합니다.  https://bcho.tistory.com/1383 구글에서 제공하는 통합 머신러닝 플랫폼인 Vertex AI를 이용해서 MNIST 데이터를 학습하고 모델을 배포하고 Endpoint…"/><meta data-react-helmet="true" property="og:image" content="https://ssuwani.github.io/images/ogp.png"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="google-site-verification" content="imj7G-ZerBh3MsHkiadmx_eAwSqAeRatmOr0p2L0eJs"/><meta data-react-helmet="true" name="naver-site-verification" content="159e698b7dfa582ec3ebdb9c2ad273a4d9a0ed4c"/><script data-react-helmet="true" type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","headline":"[MLOps] Vertex AI에서 MNIST 학습, 배포, 서빙","image":"https://ssuwani.github.io/images/ogp.png","editor":"장수완","datePublished":"2021-10-27","dateCreated":"2021-10-27","dateModified":"2021-10-27","description":"조대협님의 블로그를 참고했습니다! 감사합니다.  https://bcho.tistory.com/1383 구글에서 제공하는 통합 머신러닝 플랫폼인 Vertex AI를 이용해서 MNIST 데이터를 학습하고 모델을 배포하고 Endpoint…","author":{"@type":"Person","name":"장수완","image":"https://ssuwani.github.io/images/avatar.png"},"publisher":{"@type":"Organization","name":"장수완","logo":{"@type":"ImageObject","url":"https://ssuwani.github.io/images/avatar.png","width":150,"height":150}}}</script><script data-react-helmet="true" type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://ssuwani.github.io","name":"HOME"}},{"@type":"ListItem","position":2,"item":{"@id":"https://ssuwani.github.io/blog","name":"블로그"}},{"@type":"ListItem","position":3,"item":{"name":"[MLOps] Vertex AI에서 MNIST 학습, 배포, 서빙"}}]}</script><style data-styled="iiFkmw gNlojF fmzpzu kdMpgf gcLmet liSTQX kAscXg devmEB fTBRLr izTbdK hAYIMS bCIgZk irBJXq KBaLi hyGLFx htBxaS jNtXLx ejjRZu cuevDS AxgAV bpgLWH gFKJVf kilaSx bvCMhp" data-styled-version="4.4.1">
/* sc-component-id: sc-global-4288524390 */
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline;-webkit-tap-highlight-color:rgba(0,0,0,0);} html,body{height:100%;} body{--bg:#f5f5f5;--textNormal:#21242d;--headerBackground:#ffffff;--bioBackground:#f5f5f5;--bioColor:rgba(0,0,0,0.87);--bioHighlight:#000000;--categoryHeader:rgba(0,0,0,0.87);--categoryColor:rgba(0,0,0,0.87);--categotyImgage:linear-gradient(-45deg,#ffa649,#f7645b,#805ed4);--postCardColor:rgba(0,0,0,0.87);--postCardHighlight:rgba(0,0,0,0.08);--postCardEmoji:#ffffff;--postCardDivideLine:#969fa7;--tableOfContentsFocusColor:rgb(33,37,41) background-color:var(--bg);color:var(--textNormal);line-height:1.6;font-size:100%;font-weight:400;font-family:"Helvetica Neue",Helvetica,Arial,"Hiragino Kaku Gothic ProN","Hiragino Kaku Gothic Pro","メイリオ",Meiryo,sans-serif;-webkit-text-size-adjust:100%;} body.dark{--bg:#21242d;--textNormal:#21242d;--headerBackground:#3B71DA;--bioBackground:#313746;--bioColor:#ffffff;--bioHighlight:#ffffff;--categoryHeader:#ffffff;--categoryColor:#727d86;--categotyImgage:#313746;--postCardColor:#ffffff;--postCardHighlight:#313746;--postCardEmoji:#313746;--postCardDivideLine:#313746;--tableOfContentsFocusColor:#f1f4f7;background-color:var(--bg);color:var(--textNormal);line-height:1.6;font-size:100%;font-weight:400;font-family:"Helvetica Neue",Helvetica,Arial,"Hiragino Kaku Gothic ProN","Hiragino Kaku Gothic Pro","メイリオ",Meiryo,sans-serif;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased;} article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block;} a{color:#20a8ea;-webkit-text-decoration:none;text-decoration:none;word-break:break-all;-webkit-transition:.2s;transition:.2s;} a:focus{outline:none;} ol,ul,li{list-style:none;} blockquote,q{quotes:none;} blockquote::before,blockquote::after,q::before,q::after{content:'';content:none;} table{border-collapse:collapse;border-spacing:0;} *{box-sizing:border-box;} img{max-width:100%;} button,input{font-family:inherit;font-size:inherit;background:none;border:none;outline:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;border-radius:0;resize:none;} button:focus,input:focus{outline:none;}
/* sc-component-id: ContentWrapper__IndexContent-sc-184f5wv-0 */
.gNlojF{max-width:1250px;margin:0 auto;padding:0 1.5em;} @media screen and (max-width:950px){.gNlojF{max-width:760px;}} @media screen and (max-width:500px){.gNlojF{padding:0 20px;}}
/* sc-component-id: Footer__FooterContent-bp79pz-0 */
.kilaSx{padding:0.1em 0;}
/* sc-component-id: Footer__FooterInner-bp79pz-1 */
.bvCMhp{margin-top:3em;text-align:center;padding:1.5em;border-top:solid 1px #313746;color:#727d86;font-size:14px;} .bvCMhp a{color:#727d86;-webkit-text-decoration:underline;text-decoration:underline;}
/* sc-component-id: ColorModeToggle__ToggleButton-sc-1os8jrt-0 */
.kdMpgf{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-left:auto;cursor:pointer;} .kdMpgf .icon-sun{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;text-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:100%;color:#222;} .kdMpgf .icon-moon{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;text-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:100%;color:#fff;}
/* sc-component-id: Header__HeaderTag-sc-17pj47e-0 */
.iiFkmw{background:var(--headerBackground);width:100%;box-shadow:rgba(0,0,0,0.2) 0px 3px 3px -2px,rgba(0,0,0,0.14) 0px 3px 4px 0px,rgba(0,0,0,0.12) 0px 1px 8px 0px;}
/* sc-component-id: Header__HeaderInner-sc-17pj47e-1 */
.fmzpzu{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:5px;} .fmzpzu .logo{width:150px;height:75px;} @media screen and (max-width:500px){.fmzpzu .logo{margin:0 auto;}} .fmzpzu .message-link{position:absolute;right:0;top:7px;display:block;width:34px;} .fmzpzu .message-link:hover{top:5px;}
/* sc-component-id: Layout__Content-sc-12w4uko-0 */
.gcLmet{margin-top:2em;min-height:85vh;} @media screen and (max-width:950px){.gcLmet{display:block;}} @media screen and (max-width:500px){.gcLmet{margin-top:0;}}
/* sc-component-id: MainWrapper__IndexWrapper-sel83t-0 */
.liSTQX{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;margin-top:2em;min-height:85vh;} @media screen and (max-width:950px){.liSTQX{display:block;}} @media screen and (max-width:500px){.liSTQX{margin-top:0;}}
/* sc-component-id: MainWrapper__ContentsWrapper-sel83t-1 */
.kAscXg{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:calc(100% - 290px - 40px);margin-right:40px;} @media screen and (max-width:950px){.kAscXg{width:100%;}}
/* sc-component-id: CategoryLabel__Wrapper-jondgh-0 */
.irBJXq .category-text{padding:0.3em 1em;display:inline-block;display:inline;padding:3px 6px;line-height:1.2;font-size:12px;border-radius:2px;font-weight:700;color:#fff;} @media screen and (max-width:950px){.irBJXq .category-text{font-size:11px;padding:2.5px 6px;}}
/* sc-component-id: RelatedPosts__Wrapper-u5r1r9-0 */
.hyGLFx{background:#f1f4f7;padding:2em 2.5em;} @media screen and (max-width:500px){.hyGLFx{padding:30px 20px;}}
/* sc-component-id: RelatedPosts__PostCardWrapper-u5r1r9-1 */
.htBxaS .post-card-link{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:1em;padding:15px;background:#fff;border-radius:5px;color:#313746;box-shadow:0 1px 2px rgba(0,0,0,0.1);} .htBxaS .post-card-link:hover{background:#e0ebf1;} @media screen and (max-width:500px){.htBxaS .post-card-link{padding:10px;}}
/* sc-component-id: RelatedPosts__PostCardEmoji-u5r1r9-2 */
.jNtXLx{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;box-shadow:0 2px 4px rgba(0,0,0,0.4);margin:0;width:80px;height:80px;background:#f1f4f7;border-radius:4px;font-size:50px;} .jNtXLx img{width:55px;height:55px;}
/* sc-component-id: RelatedPosts__PostCardContent-u5r1r9-3 */
.ejjRZu{width:calc(100% - 80px);padding-left:15px;} .ejjRZu h5{font-size:1.1em;font-weight:700;line-height:1.45;} .ejjRZu time{display:block;margin-bottom:0.1em;-webkit-letter-spacing:0.05em;-moz-letter-spacing:0.05em;-ms-letter-spacing:0.05em;letter-spacing:0.05em;font-size:0.8em;color:#969fa7;} @media screen and (max-width:500px){.ejjRZu{padding-left:15px;}.ejjRZu h5{font-size:1em;}}
/* sc-component-id: TableOfContents__TableIndex-v24s1h-0 */
.cuevDS{position:-webkit-sticky;position:sticky;top:2em;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:left;-webkit-justify-content:left;-ms-flex-pack:left;justify-content:left;width:320px;padding:1.5em;background:none;border-radius:4px;} @media screen and (max-width:950px){.cuevDS{position:relative;margin:2em 0;width:100%;}} @media screen and (max-width:500px){.cuevDS{padding:1.3em 1em;}}
/* sc-component-id: TableOfContents__TableWrapper-v24s1h-1 */
.AxgAV{display:block;width:100%;max-height:calc(100vh - 150px);word-break:break-word;color:black;overflow:auto;border-left:1.5px solid rgb(233,236,239);}
/* sc-component-id: TableOfContents__TableHeader-v24s1h-2 */
.bpgLWH{display:block;text-align:left;font-size:17px;color:var(--bioColor);padding-left:15px;margin-bottom:15px;}
/* sc-component-id: TableOfContents__TableContents-v24s1h-3 */
.gFKJVf{margin:0 10px;font-size:14px;overflow:hidden;-webkit-transition:all 0.125s ease-in 0s;transition:all 0.125s ease-in 0s;} .gFKJVf a{display:block;color:rgb(134,142,150);} .gFKJVf a:hover{color:var(--tableOfContentsFocusColor);} .gFKJVf ul{list-style:none;margin-left:10px;margin-bottom:0px;line-height:1.5rem;} .gFKJVf ul > li a[href='']{color:var(--tableOfContentsFocusColor);-webkit-transform:scale(1.05);-ms-transform:scale(1.05);transform:scale(1.05);}
/* sc-component-id: post__Content-sc-1poaq2w-0 */
.devmEB{position:relative;background:#fff;overflow:hidden;font-size:16px;} .devmEB:before,.devmEB:after{content:'';position:absolute;width:0;height:0;z-index:5;-webkit-transition:all 0.2s ease-out 0s;transition:all 0.2s ease-out 0s;} .devmEB:before{top:0;left:0;border-top:20px solid var(--bg);border-right:20px solid transparent;} .devmEB:after{bottom:0;right:0;border-bottom:20px solid var(--bg);border-left:20px solid transparent;} @media screen and (max-width:500px){.devmEB{margin:0 -20px;}.devmEB:before,.devmEB:after{content:none;}}
/* sc-component-id: post__HeroImage-sc-1poaq2w-1 */
.fTBRLr{position:relative;background:#313746;text-align:center;background-image:url("/static/pattern-00b88abde489053a0ab3b3e799db37b9.svg");background-repeat:repeat;background-size:400px;min-height:230px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;} .fTBRLr .emoji{width:110px;height:110px;} @media screen and (max-width:500px){.fTBRLr{min-height:190px;}}
/* sc-component-id: post__ContentMain-sc-1poaq2w-2 */
.izTbdK{padding:1.8em 2.5em;} @media screen and (max-width:500px){.izTbdK{padding:30px 20px;}}
/* sc-component-id: post__PostTitle-sc-1poaq2w-3 */
.bCIgZk{margin:0.1em 0 0.3em;font-size:1.8em;font-weight:700;line-height:1.5;} @media screen and (max-width:500px){.bCIgZk{font-size:25px;}}
/* sc-component-id: post__PostDate-sc-1poaq2w-4 */
.hAYIMS{display:block;color:#969fa7;font-size:0.9em;-webkit-letter-spacing:0.05em;-moz-letter-spacing:0.05em;-ms-letter-spacing:0.05em;letter-spacing:0.05em;}
/* sc-component-id: post__PostContent-sc-1poaq2w-5 */
.KBaLi{margin:1.5em 0 1em;line-height:1.9;} .KBaLi .gatsby-highlight{margin:1.5em 0;} @media screen and (max-width:500px){.KBaLi .gatsby-highlight{margin:1.5em -20px;}} .KBaLi code[class*='language-'],.KBaLi pre[class*='language-']{-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;font-family:Menlo,Monaco,'Courier New',monospace;color:#ccc;text-shadow:none;word-break:break-all;} .KBaLi pre[class*='language-'],.KBaLi:not(pre) > code[class*='language-']{background:#313746;border-radius:8px;box-shadow:0 0 10px rgba(0,0,0,0.5);} @media screen and (max-width:500px){.KBaLi pre[class*='language-'],.KBaLi:not(pre) > code[class*='language-']{border-radius:0;}} .KBaLi pre[class*='language-']{padding:1.2em 1.2em;-webkit-overflow-scrolling:touch;position:relative;font-size:14.5px;line-height:1.7;overflow:auto;} .KBaLi .gatsby-highlight pre[class*='language-'].line-numbers{padding-left:3.4em;} .KBaLi pre[class*='language-'].line-numbers span.line-numbers-rows{padding:1.2em 0 1.2em 0.7em;background-color:hsla(0,0%,78.4%,0.15);border:none;} .KBaLi .token.comment,.KBaLi .token.block-comment,.KBaLi .token.prolog,.KBaLi .token.doctype,.KBaLi .token.cdata{color:#999;} .KBaLi .token.punctuation{color:#ccc;} .KBaLi .token.tag,.KBaLi .token.attr-name,.KBaLi .token.namespace,.KBaLi .token.deleted{color:#e2777a;} .KBaLi .token.function-name{color:#6196cc;} .KBaLi .token.boolean,.KBaLi .token.number,.KBaLi .token.function{color:#f08d49;} .KBaLi .token.property,.KBaLi .token.class-name,.KBaLi .token.constant,.KBaLi .token.symbol{color:#f8c555;} .KBaLi .token.selector,.KBaLi .token.important,.KBaLi .token.atrule,.KBaLi .token.keyword,.KBaLi .token.builtin{color:#cc99cd;} .KBaLi .token.string,.KBaLi .token.char,.KBaLi .token.attr-value,.KBaLi .token.regex,.KBaLi .token.variable{color:#7ec699;} .KBaLi .token.operator,.KBaLi .token.entity,.KBaLi .token.url{color:#67cdcc;} .KBaLi .token.important,.KBaLi .token.bold{font-weight:bold;} .KBaLi .token.italic{font-style:italic;} .KBaLi .token.entity{cursor:help;} .KBaLi .token.inserted{color:green;} .KBaLi .gatsby-code-title{position:relative;margin:1.5em 0 -24px auto;background:#616161;color:#fff;font-size:12px;height:24px;padding:0 8px;line-height:24px;font-family:SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-weight:500;border-radius:0 5px;display:table;z-index:2;} @media screen and (max-width:500px){.KBaLi .gatsby-code-title{border-radius:0 0 0 5px;margin-right:-20px;}} .KBaLi .gatsby-code-title + .gatsby-highlight{margin-top:0;} .KBaLi p > code,.KBaLi li > code{color:#ff3860 !important;background:#f9f1f3;padding:0.15em 0.4em;margin:0.2em;border-radius:4px;font-size:0.85em;word-break:break-all;white-space:pre-line;} .KBaLi strong > code{font-family:inherit !important;} .KBaLi a:hover{-webkit-text-decoration:underline;text-decoration:underline;} .KBaLi p{margin:0.5em 0;} .KBaLi h1,.KBaLi h2,.KBaLi h3,.KBaLi h4,.KBaLi h5,.KBaLi h6{margin:40px 0 10px;font-weight:700;line-height:1.5;} .KBaLi h1{margin:45px 0 12px;padding:5px 0 5px 17px;font-size:1.55em;} .KBaLi h1:before{position:absolute;top:0;left:0;content:"";display:inline-block;width:5px;height:100%;border-radius:5px;background:linear-gradient(0deg,#ffa649 0%,#ffa649 50%,#f7645b 50%,#f7645b 100%);} .KBaLi h2{position:relative;margin:45px 0 12px;padding:5px 0 5px 17px;font-size:1.40em;} .KBaLi h2:before{position:absolute;top:0;left:0;content:"";display:inline-block;width:5px;height:100%;border-radius:5px;background:linear-gradient(0deg,#ffa649 0%,#ffa649 50%,#f7645b 50%,#f7645b 100%);} .KBaLi h3{margin:40px 0 12px;font-size:1.40em;} .KBaLi h4{position:relative;padding-left:18px;font-size:1.2em;} .KBaLi h4:before{position:absolute;top:.2em;left:0;content:"";display:inline-block;width:14px;height:19px;background-image:url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIyLjEuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IuODrOOCpOODpOODvF8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiCgkgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMzAgNDUiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwIDQ1OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0Y3NjQ1Qzt9Cgkuc3Qxe2ZpbGw6I0ZGQTc0ODt9Cjwvc3R5bGU+Cjx0aXRsZT5pY29uPC90aXRsZT4KPHBhdGggY2xhc3M9InN0MCIgZD0iTTI4LjEsMzAuMWMwLDcuNS02LjEsMTMuNi0xMy42LDEzLjZTMC45LDM3LjcsMC45LDMwLjFTNywxNi41LDE0LjUsMTYuNVMyOC4xLDIyLjYsMjguMSwzMC4xeiIvPgo8cGF0aCBjbGFzcz0ic3QxIiBkPSJNMjguMSwxNS42YzAsNy41LTYuMSwxMy42LTEzLjYsMTMuNlMwLjksMjMuMSwwLjksMTUuNlM3LDIsMTQuNSwyUzI4LjEsOC4xLDI4LjEsMTUuNnoiLz4KPC9zdmc+Cg==");background-size:contain;background-repeat:no-repeat;} .KBaLi ul,.KBaLi ol{margin:1em 0;} .KBaLi ul p,.KBaLi ol p{margin:0;} .KBaLi ul{padding-left:1.2em;} .KBaLi ul li{margin:.4em 0;list-style:disc;} .KBaLi ul ul,.KBaLi ul ol{margin:0;} .KBaLi ol{counter-reset:number;} .KBaLi ol > li{list-style:none;list-style-position:inside;position:relative;padding:0 0 0 30px;margin:0.5em 0;} .KBaLi ol > li:before{display:inline-block;position:absolute;left:0;top:0;width:20px;height:20px;margin:.4em 0;border-radius:25%;background:#5c9ee7;color:#fff;font-weight:700;font-size:14px;text-align:center;line-height:20px;content:counter(number);counter-increment:number;} .KBaLi ol ul{margin:0;} .KBaLi strong{font-weight:550;font-size:1.1em;} .KBaLi em{font-style:italic;} .KBaLi del{-webkit-text-decoration:line-through;text-decoration:line-through;} .KBaLi hr{display:block;margin:2em 0;border:none;border-top:dotted 3px #e1eaf3;} .KBaLi table{display:block;margin:1em 0;border-spacing:2px;border-collapse:separate;overflow:auto;-webkit-overflow-scrolling:touch;width:auto;font-size:.9em;line-height:1.4;} .KBaLi table th{background-color:#313746;color:#FFF;padding:10px 12px;text-align:center;font-weight:700;} .KBaLi table th[align="center"]{text-align:center;} .KBaLi table th[align="right"]{text-align:right;} .KBaLi table td{background-color:#f1f4f7;color:#313746;padding:10px 12px;} .KBaLi table td code[class*='language-']{color:#313746;} .KBaLi table thead tr th:first-child{border-radius:5px 0 0 0;} .KBaLi table thead tr th:last-child{border-radius:0 5px 0 0;} .KBaLi table tbody tr:last-child td:first-child{border-radius:0 0 0 5px;} .KBaLi table tbody tr:last-child td:last-child{border-radius:0 0 5px 0;} .KBaLi blockquote{margin:1em 0;padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5;} .KBaLi .gatsby-resp-image-wrapper{margin:2em 0;box-shadow:1px 1px 20px lightgrey;border-radius:4px;overflow:hidden;} .KBaLi .anchor-header{margin:2px 0 0 0;} .KBaLi .custom-block{margin:1em 0;background:#f1f4f7;} .KBaLi .custom-block-heading{font-weight:700;} .KBaLi .custom-block-heading .emoji{width:1.2em !important;height:1.2em !important;vertical-align:-0.2em !important;} .KBaLi .custom-block-body{font-size:0.92em;} .KBaLi .custom-block-body > *:first-child{margin-top:0;} .KBaLi .custom-block-body > *:last-child{margin-bottom:0;} .KBaLi .custom-block-body h5{font-size:1.05em;margin:20px 0 5px;} .KBaLi > *:first-child{margin-top:0;} .KBaLi .custom-block.simple{padding:1em 1.2em;border-radius:5px;} .KBaLi .custom-block.simple .custom-block-heading{font-size:1.1em;} .KBaLi .custom-block.info,.KBaLi .custom-block.alert,.KBaLi .custom-block.notice{padding:0.7em 1em;border-left:solid 4px #20a8ea;border-radius:1px 3px 3px 1px;} .KBaLi .custom-block.alert{border-left-color:#f7615f;background:#ffeff0;} .KBaLi .custom-block.alert .custom-block-heading{color:#f7615f;} .KBaLi .custom-block.notice{border-left-color:#ffa22b;background:#fff4df;} .KBaLi .custom-block.notice .custom-block-heading{color:#ffa22b;} .KBaLi .custom-block.image-small,.KBaLi .custom-block.image-medium{background:#c0e2fb;padding:1.5em;text-align:center;border-radius:5px;} .KBaLi .custom-block.image-small .gatsby-resp-image-wrapper,.KBaLi .custom-block.image-medium .gatsby-resp-image-wrapper{margin:0;border:none;box-shadow:0 5px 15px rgba(0,0,0,0.15);} .KBaLi .custom-block.image-small .gatsby-resp-image-wrapper{max-width:350px !important;border:none;} .KBaLi .custom-block.image-medium .gatsby-resp-image-wrapper{max-width:450px !important;border:none;}</style><link as="script" rel="preload" href="/webpack-runtime-91cbc5ed6c6972297464.js"/><link as="script" rel="preload" href="/framework-59a9ef51c55d9b62f7de.js"/><link as="script" rel="preload" href="/styles-09367947dddffb36886c.js"/><link as="script" rel="preload" href="/app-e1cbbafd9e0d67222ba1.js"/><link as="script" rel="preload" href="/de71a805-ab927e1633c63597cfb4.js"/><link as="script" rel="preload" href="/53b27b57f60ee3e1ca57a66cde9add975dffb161-2b60719b91291bfda095.js"/><link as="script" rel="preload" href="/component---src-templates-post-tsx-ee1c336a1aa63cfbc58e.js"/><link as="fetch" rel="preload" href="/page-data/category/blog/mlops/mnist_training_vertex/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><script>
void function() {
  window.__onThemeChange = function() {}

  var preferredTheme
  try {
    preferredTheme = localStorage.getItem('theme')
  } catch (err) { }

  function setTheme(newTheme) {
    if (preferredTheme && document.body.classList.contains(preferredTheme)) {
      document.body.classList.replace(preferredTheme, newTheme)
    } else {
      document.body.classList.add(newTheme)
    }

    window.__theme = newTheme
    preferredTheme = newTheme
    window.__onThemeChange(newTheme)
  }

  window.__setPreferredTheme = function(newTheme) {
    setTheme(newTheme)
    try {
      localStorage.setItem('theme', newTheme)
    } catch (err) {}
  }

  var darkQuery = window.matchMedia('(prefers-color-scheme: dark)')
  darkQuery.addListener(function(e) {
    window.__setPreferredTheme(e.matches ? 'dark' : 'light')
  })

  setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'))
}()
    </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="App" style="background-color:var(--bg);color:var(--textNormal);transition:color 0.2s ease-out, background 0.2s ease-out"><header class="Header__HeaderTag-sc-17pj47e-0 iiFkmw"><div class="ContentWrapper__IndexContent-sc-184f5wv-0 gNlojF"><div class="Header__HeaderInner-sc-17pj47e-1 fmzpzu"><a class="logo-link" href="/"><img class="logo" src="/static/logo-ec471251d97b410ffb71148a2ce05745.png" alt="어서OpShow"/></a><div class="ColorModeToggle__ToggleButton-sc-1os8jrt-0 kdMpgf"><div style="position:relative;display:inline-block;text-align:left;opacity:1;direction:ltr;border-radius:13px;-webkit-transition:opacity 0.25s;-moz-transition:opacity 0.25s;transition:opacity 0.25s;touch-action:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none"><div class="react-switch-bg" style="height:26px;width:54px;margin:0;position:relative;background:#d9dfe2;border-radius:13px;cursor:pointer;-webkit-transition:background 0.25s;-moz-transition:background 0.25s;transition:background 0.25s"><div style="height:26px;width:29px;position:relative;opacity:0;pointer-events:none;-webkit-transition:opacity 0.25s;-moz-transition:opacity 0.25s;transition:opacity 0.25s"><div class="icon-moon checkedIcon"><svg width="24" height="24" fill="#EFDC05"><rect width="24" height="24" fill="none" rx="0" ry="0"></rect><path fill-rule="evenodd" clip-rule="evenodd" d="M14.8102 3.2H13.8202C13.4902 3.2 13.2302 2.93 13.2302 2.6C13.2302 2.27 13.5002 2 13.8302 2H16.2602C16.5002 2 16.7202 2.15 16.8102 2.37C16.9002 2.59 16.8502 2.85 16.6802 3.02L15.2702 4.43H16.2602C16.5902 4.43 16.8602 4.7 16.8602 5.03C16.8602 5.36 16.5902 5.63 16.2602 5.63H13.8202C13.5802 5.63 13.3602 5.48 13.2702 5.26C13.1802 5.04 13.2302 4.78 13.4002 4.61L14.8102 3.2ZM20.1401 11.0101H21.1301C21.4601 11.0101 21.7401 11.2801 21.7401 11.6101C21.7401 11.9401 21.4701 12.2101 21.1401 12.2101H18.7001C18.4601 12.2101 18.2401 12.0601 18.1501 11.8401C18.0601 11.6201 18.1101 11.3601 18.2801 11.1901L19.6901 9.78008H18.7001C18.3701 9.78008 18.1001 9.51008 18.1001 9.18008C18.1001 8.85008 18.3701 8.58008 18.7001 8.58008H21.1301C21.3701 8.58008 21.5901 8.73008 21.6801 8.95008C21.7701 9.17008 21.7201 9.43008 21.5501 9.60008L20.1401 11.0101ZM11.0302 9.8499H12.8502L10.7002 11.9999C10.5302 12.1699 10.4802 12.4299 10.5702 12.6499C10.6602 12.8699 10.8802 13.0199 11.1202 13.0199H14.2902C14.6202 13.0199 14.8902 12.7499 14.8902 12.4199C14.8902 12.0899 14.6202 11.8199 14.2902 11.8199H12.5602L14.7102 9.6699C14.8802 9.4999 14.9302 9.2399 14.8402 9.0199C14.7502 8.7999 14.5302 8.6499 14.2902 8.6499H11.0202C10.6902 8.6499 10.4202 8.9199 10.4202 9.2499C10.4202 9.5799 10.7002 9.8499 11.0302 9.8499ZM14.5501 16.89C15.6601 16.89 16.7201 16.66 17.7101 16.19C17.9401 16.08 18.2101 16.13 18.3801 16.3C18.5601 16.48 18.6101 16.75 18.5001 16.98C17.0901 20.05 13.9901 22.03 10.6001 22.03C5.79013 22.03 1.88013 18.12 1.88013 13.31C1.88013 9.94004 3.87013 6.84004 6.93013 5.40004C7.16013 5.29004 7.43012 5.34004 7.61012 5.52004C7.79012 5.70004 7.84013 5.97004 7.73013 6.20004C7.27013 7.19004 7.03012 8.26004 7.03012 9.38004C7.03012 13.52 10.4001 16.89 14.5501 16.89ZM3.09013 13.31C3.09013 17.46 6.46012 20.83 10.6101 20.83C12.9901 20.83 15.2001 19.7 16.6001 17.85C15.9401 18.01 15.2501 18.09 14.5501 18.09C9.74013 18.09 5.83012 14.18 5.83012 9.38004C5.83012 8.68004 5.91013 7.99004 6.07013 7.32004C4.22013 8.73004 3.09013 10.94 3.09013 13.31Z"></path></svg></div></div><div style="height:26px;width:29px;position:absolute;opacity:1;right:0;top:0;pointer-events:none;-webkit-transition:opacity 0.25s;-moz-transition:opacity 0.25s;transition:opacity 0.25s"><div class="icon-sun uncheckedIcon"><svg stroke="currentColor" fill="currentColor" stroke-width="0" version="1.2" baseProfile="tiny" viewBox="0 0 24 24" size="24" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M12 6.934l1-2.934c.072-.213.078-.452 0-.682-.188-.553-.789-.848-1.341-.659-.553.189-.847.788-.659 1.341l1 2.934zM4 11c-.213-.072-.452-.078-.682 0-.553.188-.848.789-.659 1.341.189.553.788.847 1.341.659l2.934-1-2.934-1zM12 17.066l-1 2.934c-.072.213-.078.452 0 .682.188.553.789.848 1.341.659.553-.189.847-.788.659-1.341l-1-2.934zM21.341 11.657c-.188-.553-.788-.848-1.341-.659l-2.934 1 2.934 1c.213.072.452.078.682 0 .552-.188.847-.789.659-1.341zM5.636 7.05l2.781 1.367-1.367-2.781c-.1-.202-.265-.375-.482-.482-.524-.258-1.157-.042-1.415.482-.257.523-.041 1.157.483 1.414zM5.153 17.432c-.257.523-.041 1.156.482 1.414.523.257 1.157.041 1.414-.482l1.367-2.781-2.781 1.367c-.201.099-.374.263-.482.482zM18.363 16.949l-2.781-1.367 1.367 2.781c.1.202.264.375.482.482.523.257 1.156.041 1.414-.482s.042-1.157-.482-1.414zM18.844 6.566c.258-.524.042-1.157-.481-1.415-.523-.257-1.157-.041-1.414.482l-1.369 2.783 2.782-1.368c.202-.1.375-.264.482-.482zM12 7.5c-2.481 0-4.5 2.019-4.5 4.5s2.019 4.5 4.5 4.5 4.5-2.019 4.5-4.5-2.019-4.5-4.5-4.5z"></path></svg></div></div></div><div class="react-switch-handle" style="height:26px;width:26px;background:#ffffff;display:inline-block;cursor:pointer;border-radius:50%;position:absolute;transform:translateX(0px);top:0;outline:0;box-shadow:0px 1px 5px rgba(0, 0, 0, 0.6);border:0;-webkit-transition:background-color 0.25s, transform 0.25s, box-shadow 0.15s;-moz-transition:background-color 0.25s, transform 0.25s, box-shadow 0.15s;transition:background-color 0.25s, transform 0.25s, box-shadow 0.15s"></div><input type="checkbox" role="switch" style="border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px" id="normal-switch"/></div></div></div></div></header><div class="ContentWrapper__IndexContent-sc-184f5wv-0 gNlojF"><div class="Layout__Content-sc-12w4uko-0 gcLmet"><main><div class="MainWrapper__IndexWrapper-sel83t-0 liSTQX"><div class="MainWrapper__ContentsWrapper-sel83t-1 kAscXg"><section class="post__Content-sc-1poaq2w-0 devmEB"><p class="post__HeroImage-sc-1poaq2w-1 fTBRLr"><img class="emoji" draggable="false" alt="🏋️" src="https://twemoji.maxcdn.com/v/12.1.6/svg/1f3cb.svg"/></p><div class="post__ContentMain-sc-1poaq2w-2 izTbdK"><time class="post__PostDate-sc-1poaq2w-4 hAYIMS">2021.10.27</time><h1 class="post__PostTitle-sc-1poaq2w-3 bCIgZk">[MLOps] Vertex AI에서 MNIST 학습, 배포, 서빙</h1><div class="CategoryLabel__Wrapper-jondgh-0 irBJXq"><a class="category-text" style="background:#ffa22b" href="/category/blog">블로그</a></div><div class="post__PostContent-sc-1poaq2w-5 KBaLi"><div class="custom-block info"><div class="custom-block-heading">조대협님의 블로그를 참고했습니다! 감사합니다. </div><div class="custom-block-body"><p><a href="https://bcho.tistory.com/1383">https://bcho.tistory.com/1383</a></p></div></div>
<p>구글에서 제공하는 통합 머신러닝 플랫폼인 Vertex AI를 이용해서 MNIST 데이터를 학습하고 모델을 배포하고 Endpoint를 생성해 서빙하는 것까지 실습해보겠습니다!</p>
<p>목차</p>
<ol>
<li>train.py 파일 만들기</li>
<li>도커 컨테이너로 패키징하기</li>
<li>Vertex AI에 Train JOB 생성하기</li>
<li>배포 및 서빙</li>
<li>Test</li>
</ol>
<h2 id="1-trainpy-파일-만들기" style="position:relative;"><a href="#1-trainpy-%ED%8C%8C%EC%9D%BC-%EB%A7%8C%EB%93%A4%EA%B8%B0" aria-label="1 trainpy 파일 만들기 permalink" class="anchor-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. train.py 파일 만들기</h2>
<p>moist 데이터를 불러와서 간단한 Linear 모델을 만들고 모델 학습 및 저장하는 코드이다.</p>
<p>여기서 주의깊게 봐야할 곳은 마지막에 있는 <code class="language-text">model.save</code> 부분이다. GCS의 bucket으로 경로가 되어있는 것을 볼 수 있다. </p>
<ul>
<li>GCS의 버킷의 region은 <code class="language-text">us-central1</code> 으로 지정해서 만들자. (왜인지 한국으로 하면 엔드포인트 생성 시 오류가 난다. ㅠㅠ)</li>
<li>경로의 마지막은 <code class="language-text">model</code> 이라는 폴더로 되어 있어야 한다. </li>
</ul>
<div class="gatsby-highlight" data-language="python"><pre style="counter-reset: linenumber NaN" class="language-python line-numbers"><code class="language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf

mnist <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>mnist
<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>test_x<span class="token punctuation">,</span> test_y<span class="token punctuation">)</span> <span class="token operator">=</span> mnist<span class="token punctuation">.</span>load_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
train_x <span class="token operator">=</span> train_x <span class="token operator">/</span> <span class="token number">255.0</span>
test_x <span class="token operator">=</span> test_x <span class="token operator">/</span> <span class="token number">255.0</span>

<span class="token keyword">def</span> <span class="token function">build_model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
        <span class="token punctuation">[</span>
            tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span>input_shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'softmax'</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
    model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>
        optimizer<span class="token operator">=</span><span class="token string">'adam'</span><span class="token punctuation">,</span>
        loss<span class="token operator">=</span><span class="token string">'sparse_categorical_crossentropy'</span><span class="token punctuation">,</span>
        metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> model

model <span class="token operator">=</span> build_model<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># train</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> epochs<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token comment"># evaluate</span>
loss<span class="token punctuation">,</span> acc <span class="token operator">=</span> model<span class="token punctuation">.</span>evaluate<span class="token punctuation">(</span>test_x<span class="token punctuation">,</span> test_y<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"loss : {:.4f} acc : {:.4f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>loss<span class="token punctuation">,</span> acc<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># save</span>
model<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">"gs://suwan_test/20211027/model"</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<hr>
<h2 id="2-도커-컨테이너로-패키징하기" style="position:relative;"><a href="#2-%EB%8F%84%EC%BB%A4-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88%EB%A1%9C-%ED%8C%A8%ED%82%A4%EC%A7%95%ED%95%98%EA%B8%B0" aria-label="2 도커 컨테이너로 패키징하기 permalink" class="anchor-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. 도커 컨테이너로 패키징하기</h2>
<p>Vertex AI에서 학습시 학습의 위한 코드가 패키징된 커스텀 컨테이너를 요구한다. 커스텀 컨테이너틑 google container registry 즉, gcr에 올라가 있어야 한다. 당연히 <code class="language-text">Dockerfile</code> 을 생성하는 것부터 시작한다.</p>
<h4 id="dockerfile" style="position:relative;"><a href="#dockerfile" aria-label="dockerfile permalink" class="anchor-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dockerfile</h4>
<p>이미지 태그를 적어주지 않으면 latest를 가져오는데 mnist 모델 학습에 문제되지 않을거라 판단하여 지정하지 않았다.</p>
<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> tensorflow/tensorflow

<span class="token keyword">ADD</span> train.py /

<span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span> <span class="token string">"python"</span><span class="token punctuation">,</span> <span class="token string">"train.py"</span> <span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h4 id="build--push" style="position:relative;"><a href="#build--push" aria-label="build  push permalink" class="anchor-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Build &#x26; Push</h4>
<p>gcr에 도커 컨테이너를 배포하는 것은 간단하다!!</p>
<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token assign-left variable">IMAGE_URI</span><span class="token operator">=</span><span class="token string">"gcr.io/<span class="token variable">$PROJECT_ID</span>/mnist_model:20211027"</span>
docker build ./ -t <span class="token variable">$IMAGE_URI</span> <span class="token comment"># Build</span>
docker push <span class="token variable">$IMAGE_URI</span> <span class="token comment"># Push</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Container Registry에 접속해보면 다음과 같이 컨테이너가 잘 올라가 있는걸 확인할 수 있다.</p>
<span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; ">
      <a class="gatsby-resp-image-link" href="/static/ea1280edacf215fff465d55653c8f2d2/1a867/gcr.png" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 39.361702127659576%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABA0lEQVQoz31S2W6EMBDj//8OXnjhBbEcBcSViyvx4rRpdyW2I1mZmUwcx0pUNw26rkNzrcXjASkFtt1iWQSEEFBKXT2J8zxxHIfHvu8fETXDhq8LwjgPtQJKG3Rt6wlDvB5yzuFTRNqskErDWgf7MyilwjAMmKbJK2KM4+jreZ7/J/xL3e8gn0mQTGuNbdu+J6599tZ1fVMcatoScegVjL7vkaYp8jz3ikhYVZX3sr2sqOvaX0TvaQv9N8b43i0hh5IkQZZl/pnsk5QKSMrcWutzKiMRayq9JVyWBXEcvxEG8DKqITlzkodfwP4tITeKokBZlt5L9qmAa/CUNeeCp6yp9gmHTW7oagO74QAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="gcr" title="gcr" src="/static/ea1280edacf215fff465d55653c8f2d2/1d69c/gcr.png" srcset="/static/ea1280edacf215fff465d55653c8f2d2/4dcb9/gcr.png 188w,
/static/ea1280edacf215fff465d55653c8f2d2/5ff7e/gcr.png 375w,
/static/ea1280edacf215fff465d55653c8f2d2/1d69c/gcr.png 750w,
/static/ea1280edacf215fff465d55653c8f2d2/78797/gcr.png 1125w,
/static/ea1280edacf215fff465d55653c8f2d2/aa440/gcr.png 1500w,
/static/ea1280edacf215fff465d55653c8f2d2/1a867/gcr.png 1998w" sizes="(max-width: 750px) 100vw, 750px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
  </a>
    </span>
<hr>
<h2 id="3-vertex-ai에-train-job-생성하기" style="position:relative;"><a href="#3-vertex-ai%EC%97%90-train-job-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0" aria-label="3 vertex ai에 train job 생성하기 permalink" class="anchor-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. Vertex AI에 Train JOB 생성하기</h2>
<h4 id="1-train-pipeline-만들기" style="position:relative;"><a href="#1-train-pipeline-%EB%A7%8C%EB%93%A4%EA%B8%B0" aria-label="1 train pipeline 만들기 permalink" class="anchor-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. Train Pipeline 만들기</h4>
<span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; ">
      <a class="gatsby-resp-image-link" href="/static/5f822f331372b3b65222c08dd69f8901/d9ed5/make_train.png" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 23.936170212765955%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAtklEQVQY042QyQ7CMAxE8///1xtnDjRJs9Ds7eAJcEEIYenJyjie2FHWWozeUWvDbd1wXS6wy4LiNzTR931HSknqFWMMdNE+GaMjlYZ7alC8zBjHAesTjA2I3sMLMUZ45+CE1tq8d57nV6QyUc55HGJGtF6hV8EYrJKN5JumeZyT/DZ8hoohTIGGnIgrcj2C17v/BPv5qNpCRZLePXcEMX//GYtcs5YyzanxzFxEIzyTnPMchv0PAqCGdOnTKG8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="make train" title="make train" src="/static/5f822f331372b3b65222c08dd69f8901/1d69c/make_train.png" srcset="/static/5f822f331372b3b65222c08dd69f8901/4dcb9/make_train.png 188w,
/static/5f822f331372b3b65222c08dd69f8901/5ff7e/make_train.png 375w,
/static/5f822f331372b3b65222c08dd69f8901/1d69c/make_train.png 750w,
/static/5f822f331372b3b65222c08dd69f8901/78797/make_train.png 1125w,
/static/5f822f331372b3b65222c08dd69f8901/aa440/make_train.png 1500w,
/static/5f822f331372b3b65222c08dd69f8901/d9ed5/make_train.png 2880w" sizes="(max-width: 750px) 100vw, 750px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
  </a>
    </span>
<h4 id="2-train-pipeline-configure" style="position:relative;"><a href="#2-train-pipeline-configure" aria-label="2 train pipeline configure permalink" class="anchor-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. Train Pipeline Configure</h4>
<ol>
<li>학습방법
Dataset: <strong>관리형 데이터셋 없음</strong> - 코드 내에서 load_data()를 통해 데이터를 불러온다.</li>
<li>모델 세부정보
Model name: 알아서 아무거나 하면된다. 나는 <strong>mnist_train</strong></li>
<li>
<p>학습 컨테이너</p>
<ol>
<li><strong>커스텀 컨테이너</strong></li>
<li><strong>컨테이너 이미지</strong>: Docker Push 한 경로를 찾아 선택하면 된다.
<span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; ">
      <a class="gatsby-resp-image-link" href="/static/186510176d0fc62f184bf617d37baae0/75a80/select_gcr.png" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 32.97872340425532%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABF0lEQVQoz4WQbUvDMBSF8///jYwp4rSg+ElEtg91c+7NrC9r17e0TdKm6THLGAhSvfCQ3Av3cM4lH4s5vnZb7PfUvpvNGuHhgKHq+/5nZ/vLLGUKhJUChYFV0lLWElp3UEqhrmsIIcA5t5xmp2Wt9S/6XkN1GuTTa/G+k1jQM8u9RCU6SCkQBAHiOMbBOA7D0IoPCV5ECaUUeZYiTRIczbL9Fy2ath+M/BeEsQJ5WSIrcqR5ZmKXxmEL3hqXqrWuTrc683+RvGoQzqZYTSZYPjhYOQ7mt2O41yNsHh34fgQuNWpzhiG47IwRZZI1IF4k4N8bEecV7tMMy+cp3m4meBnfYXU1QkQTeImCF8tBgmODrc/hrhm+AQqAF5wfMjl2AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="select gcr" title="select gcr" src="/static/186510176d0fc62f184bf617d37baae0/1d69c/select_gcr.png" srcset="/static/186510176d0fc62f184bf617d37baae0/4dcb9/select_gcr.png 188w,
/static/186510176d0fc62f184bf617d37baae0/5ff7e/select_gcr.png 375w,
/static/186510176d0fc62f184bf617d37baae0/1d69c/select_gcr.png 750w,
/static/186510176d0fc62f184bf617d37baae0/78797/select_gcr.png 1125w,
/static/186510176d0fc62f184bf617d37baae0/75a80/select_gcr.png 1134w" sizes="(max-width: 750px) 100vw, 750px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
  </a>
    </span></li>
<li>gs 경로 <code class="language-text">1. Train.py</code> 에서 model save 했던 경로를 선택해주면 된다. 나의 경우 <strong>gs://suwan_test/20211027/model</strong></li>
</ol>
</li>
<li>초매개변수
선택하지 않음</li>
<li>
<p>컴퓨팅 및 가격 책정</p>
<p>가장 저렴한 인스턴스인 <strong>n1-standard-4, 4 vCPUs, 15GiB memory</strong> 를 선택했다.</p>
</li>
<li>
<p>예측 컨테이너
Prediction을 위한 컨테이너를 생성해주는 부분이다.
<strong>Pre-built container</strong>
Framework: <strong>Tensorflow</strong></p>
<p>Version: <strong>2.6</strong> Latest
GPU: None
Model Directory: 모델이 저장될 경로를 선택해주면 된다. 위에서의 gs 경로와 동일하다. <strong>gs://suwan_test/20211027/model</strong></p>
</li>
</ol>
<h4 id="3-학습시작" style="position:relative;"><a href="#3-%ED%95%99%EC%8A%B5%EC%8B%9C%EC%9E%91" aria-label="3 학습시작 permalink" class="anchor-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. 학습시작</h4>
<p>이제 학습을 시작하면 된다.</p>
<span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; ">
      <a class="gatsby-resp-image-link" href="/static/4f5a133dc5223bb7883c41e735d291cf/569c6/train_button.png" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 81.38297872340425%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACHklEQVQ4y41TS7LTMBD0qVlyDM7BghO8HXugWMBLHvlYjiRL/kryr5mZJK4kRQBXukaxPK3umVFmbInNZoPD4YDtdotpmsDPsiyo6xrWWkFZljDGwFgHbRxFv0bnK8zzLHnZryJhf9SUYISMia4wRiPPc4FSBSVbGNdDuyAoLMeIrk9rTrZVCXlR4lQopDSs6hh9CDidTtBak0pD+xEDY7iA1ikFUnd2JQqZ8KgsJRaIMa5kM6GskhCetIVvEtowk5qIvu/vEAgxBnGYvamIQ25QkgLvPZ08XM5a0DQtClJ+zBWsa9F0AxEEBFIeIq0JIY7ndRiIcEb2U03Yk+WCbKlCi4KRHMRhFvKu64ikE7vjkCSG0KPpR7hmgm8nVN0k62mmGn77bvDl6wH7txy2CjCePg4LtB/XznLkTrN9Vvf8IcKPHz7h3fsX/Hj5DEzx8n6RzTw/YvP6itcb8GgppQRHpcmZl6YW2snoZB1t+H2Owbu7kWEUhmpoW/Rku2kasd+2rcwnR65p1bL1gdbjeWzuBD8QOmpSTg3hZlVVBeeckDH4f13ze1I2jWt+tpBMwQMZP2Vp5RbxaLCdcRxlNB7Be9xAGZtHoltCVsINYYWc9DdcD3tKyJA6Ue1ulT0j/D+FUqf6rsZ/Irvm/Fsh3VMm3O12dGMKmcH1ahLRVXFKSeaUnTxXSL+y8bDleaAZXMte7m28U8d2eQJG6vZvM6XXL9JAqUAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="train button" title="train button" src="/static/4f5a133dc5223bb7883c41e735d291cf/1d69c/train_button.png" srcset="/static/4f5a133dc5223bb7883c41e735d291cf/4dcb9/train_button.png 188w,
/static/4f5a133dc5223bb7883c41e735d291cf/5ff7e/train_button.png 375w,
/static/4f5a133dc5223bb7883c41e735d291cf/1d69c/train_button.png 750w,
/static/4f5a133dc5223bb7883c41e735d291cf/78797/train_button.png 1125w,
/static/4f5a133dc5223bb7883c41e735d291cf/aa440/train_button.png 1500w,
/static/4f5a133dc5223bb7883c41e735d291cf/569c6/train_button.png 1674w" sizes="(max-width: 750px) 100vw, 750px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
  </a>
    </span>
<hr>
<h2 id="4-배포-및-서빙" style="position:relative;"><a href="#4-%EB%B0%B0%ED%8F%AC-%EB%B0%8F-%EC%84%9C%EB%B9%99" aria-label="4 배포 및 서빙 permalink" class="anchor-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4. 배포 및 서빙</h2>
<p>3에서 학습을 시작했으니까 조금 기다리면 아래와 같이 학습이 종료된 걸 확인할 수 있을 것이다.</p>
<span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; ">
      <a class="gatsby-resp-image-link" href="/static/6540aae5344dbf9f16e0f69568566668/bc81a/train.png" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 37.23404255319149%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABAklEQVQoz61RXWvDMAz0//+Dg0Fpm6RNmsSx6287tm+Ky/a0jT1MIMQJ6biTmDEGUkocEdMOLi1WVWB9QikZKSWE4CkD4YJa67eZ87GTwbz3iDE2wpQypllg5QLbtoFzDiEIrxxKqR/JPhOoYM7Zr+Gcd6zLDLHxRijERuoVNmmayvqLwhchwLRxEPJJdoiQeo7Uhp2sltfAX6M2hwlM6AjtdsQCqHnB+v4G1Z0hLyfY4Qp76yCvJ5j+0voH1lQPfFR37+Gop4auuWIxhsbcnvKUbSktD6ieyMYBYRkhhzPC4w5Dy3GZ4KYbPGFNRGEekeYJkS90MnqKtRZaa/xHHHf8AHmtH+ecVrMqAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="train" title="train" src="/static/6540aae5344dbf9f16e0f69568566668/1d69c/train.png" srcset="/static/6540aae5344dbf9f16e0f69568566668/4dcb9/train.png 188w,
/static/6540aae5344dbf9f16e0f69568566668/5ff7e/train.png 375w,
/static/6540aae5344dbf9f16e0f69568566668/1d69c/train.png 750w,
/static/6540aae5344dbf9f16e0f69568566668/78797/train.png 1125w,
/static/6540aae5344dbf9f16e0f69568566668/aa440/train.png 1500w,
/static/6540aae5344dbf9f16e0f69568566668/bc81a/train.png 2862w" sizes="(max-width: 750px) 100vw, 750px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
  </a>
    </span>
<p>그리고 모델 탭이 가면 모델이 등록되어 있는 것도 확인할 수 있는 것이다. 이는  Train Pipeline Configure -> 예측 컨테이너를 설정해줬기 때문에 생성된 것이다.  </p>
<span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; ">
      <a class="gatsby-resp-image-link" href="/static/6621e9f9c7587ac72d126b705488f813/d9ed5/model.png" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 23.404255319148938%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAzklEQVQY05VQ266CMBDk//9QT8AgIqJC2u629AZztn3wzQc3mUw6nUx32iilkHNGEjjLWLWH4QB2ATFGpJQqimff96/IeQdvCY21FmUOEYkIRiswGWhhEiZNoJURQ8BxHF8hCTWn0VrXF8rROge2Dl42C7LVr1NymrJFCUveYx168PMBnh/YlleFfc0f9uu7Yns/4YsmXjONiCzNpN2yLFKZuaYnMZn2hDjfEaYB1HdwYw9zbRGnW9XSPMLfB9jhAtWeQdcOpvurd7n+Y8Y/FgWDk21thzIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="model" title="model" src="/static/6621e9f9c7587ac72d126b705488f813/1d69c/model.png" srcset="/static/6621e9f9c7587ac72d126b705488f813/4dcb9/model.png 188w,
/static/6621e9f9c7587ac72d126b705488f813/5ff7e/model.png 375w,
/static/6621e9f9c7587ac72d126b705488f813/1d69c/model.png 750w,
/static/6621e9f9c7587ac72d126b705488f813/78797/model.png 1125w,
/static/6621e9f9c7587ac72d126b705488f813/aa440/model.png 1500w,
/static/6621e9f9c7587ac72d126b705488f813/d9ed5/model.png 2880w" sizes="(max-width: 750px) 100vw, 750px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
  </a>
    </span>
<p>모델이름 클릭하면 세부 정보를 확인할 수 있다. 배포를 위해선 엔드포인트가 필요하고 없으면 생성해야한다. </p>
<p>새 엔드포인트 만들기를 선택하고 적절한 이름을 짓자. 그리고 머신유형만 선택하면된다. 나의 경우 가장 저렴한 인스턴스인 <strong>n1-standard-4, 4 vCPUs, 15GiB memory</strong> 를 선택했다. </p>
<span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; ">
      <a class="gatsby-resp-image-link" href="/static/6b466fa5c8b6844a6ef733d67242ae88/b6425/model2.png" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 39.361702127659576%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA+ElEQVQoz5VR20rDQBDd//8EX/wSxTcfBIVWsRT0IUGaNE33lm32muNOSmxEkGbgMLNnhzNnZ5k+BewPAm3bwjmPo7QIIWIYBqSUxrwETBkPfUrwPiDFLJTOYvNYJGiMAj9WaA57dMbAWou+70dMdcyDrhVmH2+fuL9bY7vaQkkOzgWEuKDruj+O/wv29LDGze0zVo+bfIwI2Q05mvJYh/ADcu29/8UTR5k4hmgBJxGdgZQqO9L5c1xuOj/Z5DVMKyBIKUfX1DPnKBPHRBYpv3Z4eX2fTU+I6bKXJcGUUiiKAkVZoq5rVNUOdcNRNQpaa9A9Dbn2U74BFmFv+i2Q9ZEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="model2" title="model2" src="/static/6b466fa5c8b6844a6ef733d67242ae88/1d69c/model2.png" srcset="/static/6b466fa5c8b6844a6ef733d67242ae88/4dcb9/model2.png 188w,
/static/6b466fa5c8b6844a6ef733d67242ae88/5ff7e/model2.png 375w,
/static/6b466fa5c8b6844a6ef733d67242ae88/1d69c/model2.png 750w,
/static/6b466fa5c8b6844a6ef733d67242ae88/78797/model2.png 1125w,
/static/6b466fa5c8b6844a6ef733d67242ae88/aa440/model2.png 1500w,
/static/6b466fa5c8b6844a6ef733d67242ae88/b6425/model2.png 2336w" sizes="(max-width: 750px) 100vw, 750px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
  </a>
    </span>
<p>엔드포인트 배포를 선택하면 시간이 좀 걸리는데 이후에 엔드포인트 탭으로 이동하면 다음과 같이 잘 생성된 것을 확인할 수 있다.</p>
<span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; ">
      <a class="gatsby-resp-image-link" href="/static/392c4f529b9258182a62f55991a0295c/93ba6/endpoint.png" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 37.765957446808514%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABEUlEQVQoz6WR2U4DMQxF8/+/hwQSVC0tdB062Sb7cnFCmZbywAOWjjxz4zi+CeOcI+eMlBL4OEJPFgN30CYgxohEhBD6eiml195TSoYPGcYlMGstWtRa0ZoLwaG1hFISUioIqSlLOOfmultImXODCSH6ybUWaqQxEd55GDPRZBHWtzVcN94xa5dgSqkuFtIENdM0sSObsVyLynz+13cj3+nNgTEGzF+sRLJ5eHwAXy2gNiuo9RKSGF8XMO8bYt217zw8P8FuN5DLF9jzANWGoeGYJXvthEQW43GHeNojDYeeY8tE+/eHbdfyx7FrgWrz+QS/f0PWar5fNsoAFypCxr+iXu6RTZO+eb3y6xX/5ueeT3eycGHDWbj/AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="endpoint" title="endpoint" src="/static/392c4f529b9258182a62f55991a0295c/1d69c/endpoint.png" srcset="/static/392c4f529b9258182a62f55991a0295c/4dcb9/endpoint.png 188w,
/static/392c4f529b9258182a62f55991a0295c/5ff7e/endpoint.png 375w,
/static/392c4f529b9258182a62f55991a0295c/1d69c/endpoint.png 750w,
/static/392c4f529b9258182a62f55991a0295c/78797/endpoint.png 1125w,
/static/392c4f529b9258182a62f55991a0295c/aa440/endpoint.png 1500w,
/static/392c4f529b9258182a62f55991a0295c/93ba6/endpoint.png 2874w" sizes="(max-width: 750px) 100vw, 750px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
  </a>
    </span>
<p>엔드포인트 이름을 클릭하면 세부정보를 확인할 수 있다. 엔드포인트 어떤 모델이 연결되어 있는지부터 예측/초, 예측 오차율, 요청/초, 총 지연시간 길이, 모델 지연시간 길이 등을 차트 간격(1시간, 6시간, 12시간, 1일, ~ 30일)으로 확인할 수 있다.</p>
<span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; ">
      <a class="gatsby-resp-image-link" href="/static/51a8af728eb07da42ed1352efdb90c8f/d438d/endpoint2.png" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 66.48936170212765%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABTklEQVQ4y6VTi27DMAj0///lpLXq0qRJ/H7fwEnTNKq0dUM6YbAB+8AipgIpJa7XK7xz8LHC+tzAe0BFKRW1PoPl6GOIGDy893hIXVWF8xEpVxwlpYR5nhFjfPK3hLNy6PsbAiVOdIAPO7op27dRQRsHa00rqrUif4BSiuzFzzHW2hbDseI8JJw6g36yGDVV1gWnfsbXoDHMlFQGnDuiZLS49ArD5PFx6mkvkK0pzuHzMra9m4z05FQxmQLjK/GHDY51WvQdi5+oCCtWv7aJ4ktbi1IylKZm+EAcFJScCQmV/Jn0wulPePAvfKBnSkVd7ogj3bgw5s6ZpqSZ+/Oyoy+7PElNxPutS0f5baItoTG6dewvweVg82vEOnI0vOXtRIH5XuNY80iJd2+1R8hl+0VbQq7GA5nXanvsfa/WrPdr/jlCUTfnNvke/7ntHd+OQv+NWRQoLAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="endpoint2" title="endpoint2" src="/static/51a8af728eb07da42ed1352efdb90c8f/1d69c/endpoint2.png" srcset="/static/51a8af728eb07da42ed1352efdb90c8f/4dcb9/endpoint2.png 188w,
/static/51a8af728eb07da42ed1352efdb90c8f/5ff7e/endpoint2.png 375w,
/static/51a8af728eb07da42ed1352efdb90c8f/1d69c/endpoint2.png 750w,
/static/51a8af728eb07da42ed1352efdb90c8f/78797/endpoint2.png 1125w,
/static/51a8af728eb07da42ed1352efdb90c8f/aa440/endpoint2.png 1500w,
/static/51a8af728eb07da42ed1352efdb90c8f/d438d/endpoint2.png 2290w" sizes="(max-width: 750px) 100vw, 750px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
  </a>
    </span>
<hr>
<h2 id="5-test" style="position:relative;"><a href="#5-test" aria-label="5 test permalink" class="anchor-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5. Test</h2>
<p>엔드포인트가 생성되었으니 잘 동작하는지 확인해보자. 모델의 세부 정보에 들어가면 모델 테스트를 할 수 있다.</p>
<span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; ">
      <a class="gatsby-resp-image-link" href="/static/cdd9c97dee7ef65f5332a55cf6cf6a81/fd561/model_test.png" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 51.59574468085106%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABg0lEQVQoz3WSaWocMRCF+/4H8SlyB4MxMYTkhxfGM71r3/VSJfXYY4NFf5RKy1NJrwdjDIQQqLUg5QprLIwWUMY3Sik3VJT6SeVYOr1fMDjn4L0HN6Ej7n5d8PBXUpaRc0LJPfKBIGr5pJTcxpnerxi4QillS2LK+PNP4DRaErfYlcOqaN4Ewreco7KB5j3O00ZjnEeswkAb1wX3faeKeulGBWgZsCyms2qsq8E0Scyzav11tW1uHAUuo279bffQNvGVPWKM7cphW/H6+xFP9/eQpzeo8+ngHfpyhptG4tKZmSOnGKczqtUYhE7QLoM+2HGCoGo3qeg0e0BXpbcVht4RP7cayEAlMGitm8vc0rbASPltZe2QXEoJIYTDhAMyrfBerZBZkBddXc77AqsUHOW5uZvbpuYqiXLOf8V3PB2i5glJ7Bg+CjkEkSMibUwMuX47z6bxYZZEvuAD7L4hSRJkQ64V+mXG88uGQlXXFBslXgnIVEl0FsHeYhBpv6fnyiT4HynDCZMh4jmdAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="model test" title="model test" src="/static/cdd9c97dee7ef65f5332a55cf6cf6a81/1d69c/model_test.png" srcset="/static/cdd9c97dee7ef65f5332a55cf6cf6a81/4dcb9/model_test.png 188w,
/static/cdd9c97dee7ef65f5332a55cf6cf6a81/5ff7e/model_test.png 375w,
/static/cdd9c97dee7ef65f5332a55cf6cf6a81/1d69c/model_test.png 750w,
/static/cdd9c97dee7ef65f5332a55cf6cf6a81/78797/model_test.png 1125w,
/static/cdd9c97dee7ef65f5332a55cf6cf6a81/aa440/model_test.png 1500w,
/static/cdd9c97dee7ef65f5332a55cf6cf6a81/fd561/model_test.png 2866w" sizes="(max-width: 750px) 100vw, 750px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
  </a>
    </span>
<p>모델 테스트를 위해 JSON 요청을 보낼 수 있는데 각 인스턴스를 JSON 배열의 항목으로 만들고 배열을 JSON 객체의 <code class="language-text">instances</code> 필드로 데이터를 제공해야 한다. </p>
<p>그러니까 instances 라는 key의 value로 mnist 데이터를 줘야한다. test 이미지를 하나 넣기 위해 다시 MNIST 데이터를 불러와보자</p>
<div class="gatsby-highlight" data-language="python"><pre style="counter-reset: linenumber NaN" class="language-python line-numbers"><code class="language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf

<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>test_x<span class="token punctuation">,</span> test_y<span class="token punctuation">)</span> <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>mnist<span class="token punctuation">.</span>load_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
test_x <span class="token operator">=</span> test_x <span class="token operator">/</span> <span class="token number">255.0</span>

test_x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>나오는 결과를 넣어 JSON을 완성하면 다음과 같다.</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"instances"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token punctuation">[</span>
        <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span>
        ...
        <span class="token number">0</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      ...
      <span class="token punctuation">[</span>
        <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span>
        ...
        <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>내가 받은 응답은 다음과 같다.</p>
<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>
 <span class="token property">"predictions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
   <span class="token punctuation">[</span>
     <span class="token number">0.00000536688867</span><span class="token punctuation">,</span>
     <span class="token number">2.52842867e-8</span><span class="token punctuation">,</span>
     <span class="token number">0.000187751983</span><span class="token punctuation">,</span>
     <span class="token number">0.00154095062</span><span class="token punctuation">,</span>
     <span class="token number">6.33089892e-9</span><span class="token punctuation">,</span>
     <span class="token number">0.0000025349284</span><span class="token punctuation">,</span>
     <span class="token number">3.57508412e-10</span><span class="token punctuation">,</span>
     <span class="token number">0.99822706</span><span class="token punctuation">,</span> # <span class="token number">7</span>
     <span class="token number">0.0000055970122</span><span class="token punctuation">,</span>
     <span class="token number">0.0000307485061</span>
   <span class="token punctuation">]</span>
 <span class="token punctuation">]</span><span class="token punctuation">,</span>
 <span class="token property">"deployedModelId"</span><span class="token operator">:</span> <span class="token string">"4307737024044990464"</span><span class="token punctuation">,</span>
 <span class="token property">"model"</span><span class="token operator">:</span> <span class="token string">"projects/697793444829/locations/us-central1/models/4193418601081864192"</span><span class="token punctuation">,</span>
 <span class="token property">"modelDisplayName"</span><span class="token operator">:</span> <span class="token string">"mnist_train"</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<span class="gatsby-resp-image-wrapper" style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 750px; ">
      <a class="gatsby-resp-image-link" href="/static/6384febebaf0da22199bdf880924a9c1/f0293/result.png" style="display: block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom: 37.765957446808514%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA6UlEQVQoz42SQWvDMAyF/f//VC87jbLbYIfRbtA1lJSR2LFlx7berKQuWVu2CB4yIu+zJEftdns8PW9hhgHOOVhrSyYMlkrNwVGABDOvkiIieO8xFKDWuqiHNg7fvce5I3RGgLwaqmKM+C9yzkgpzdALfBkCqqHatoVAxXQvnnIIAbrvEX1AHEeMNxJ/XZeSg4wtxkcjSF0M1hh8NQccz6eyXzsBlrKXmuKcpltuW7+Ogxlqy8evzQfemk/UJhzNuUreQpGPZSR/7YZ5Vu247k8M76cD9u3xF2QpWY3avHRTJynz6l/jL/0AWlpzJXL6JFoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;"></span>
  <img class="gatsby-resp-image-image" alt="result" title="result" src="/static/6384febebaf0da22199bdf880924a9c1/1d69c/result.png" srcset="/static/6384febebaf0da22199bdf880924a9c1/4dcb9/result.png 188w,
/static/6384febebaf0da22199bdf880924a9c1/5ff7e/result.png 375w,
/static/6384febebaf0da22199bdf880924a9c1/1d69c/result.png 750w,
/static/6384febebaf0da22199bdf880924a9c1/78797/result.png 1125w,
/static/6384febebaf0da22199bdf880924a9c1/aa440/result.png 1500w,
/static/6384febebaf0da22199bdf880924a9c1/f0293/result.png 2250w" sizes="(max-width: 750px) 100vw, 750px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;" loading="lazy">
  </a>
    </span>
<h4 id="파이썬에서-예측을-수행해보자" style="position:relative;"><a href="#%ED%8C%8C%EC%9D%B4%EC%8D%AC%EC%97%90%EC%84%9C-%EC%98%88%EC%B8%A1%EC%9D%84-%EC%88%98%ED%96%89%ED%95%B4%EB%B3%B4%EC%9E%90" aria-label="파이썬에서 예측을 수행해보자 permalink" class="anchor-header before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>파이썬에서 예측을 수행해보자</h4>
<div class="gatsby-highlight" data-language="python"><pre style="counter-reset: linenumber NaN" class="language-python line-numbers"><code class="language-python"><span class="token keyword">from</span> google<span class="token punctuation">.</span>cloud <span class="token keyword">import</span> aiplatform

endpoint <span class="token operator">=</span> aiplatform<span class="token punctuation">.</span>Endpoint<span class="token punctuation">(</span>
    endpoint_name<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"projects/</span><span class="token interpolation"><span class="token punctuation">{</span>PROJECT_ID<span class="token punctuation">}</span></span><span class="token string">/locations/us-central1/endpoints/</span><span class="token interpolation"><span class="token punctuation">{</span>ENDPOINT_ID<span class="token punctuation">}</span></span><span class="token string">"</span></span>
<span class="token punctuation">)</span>

<span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf

<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>test_x<span class="token punctuation">,</span> test_y<span class="token punctuation">)</span> <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>mnist<span class="token punctuation">.</span>load_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
test_x <span class="token operator">=</span> test_x <span class="token operator">/</span> <span class="token number">255.0</span>
one_image <span class="token operator">=</span> test_x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

response <span class="token operator">=</span> endpoint<span class="token punctuation">.</span>predict<span class="token punctuation">(</span><span class="token punctuation">[</span>one_image<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"real : {}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>test_y<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"predicted : {}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>response<span class="token punctuation">.</span>predictions<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment"># real : 7</span>
<span class="token comment"># predicted : 7</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><aside><div class="RelatedPosts__Wrapper-u5r1r9-0 hyGLFx"><div class="RelatedPosts__PostCardWrapper-u5r1r9-1 htBxaS"><a class="post-card-link" href="/category/blog/interview/"><p class="RelatedPosts__PostCardEmoji-u5r1r9-2 jNtXLx"><img class="emoji" draggable="false" alt="❓" src="https://twemoji.maxcdn.com/v/12.1.6/svg/2753.svg"/></p><div class="RelatedPosts__PostCardContent-u5r1r9-3 ejjRZu"><h5>[면접준비] minimum 질문&amp;답변</h5><time>2021.11.22</time></div></a></div><div class="RelatedPosts__PostCardWrapper-u5r1r9-1 htBxaS"><a class="post-card-link" href="/category/blog/hackerrank_certification/"><p class="RelatedPosts__PostCardEmoji-u5r1r9-2 jNtXLx"><img class="emoji" draggable="false" alt="📚" src="https://twemoji.maxcdn.com/v/12.1.6/svg/1f4da.svg"/></p><div class="RelatedPosts__PostCardContent-u5r1r9-3 ejjRZu"><h5>해커랭크 인증서 발급 후기</h5><time>2021.11.19</time></div></a></div><div class="RelatedPosts__PostCardWrapper-u5r1r9-1 htBxaS"><a class="post-card-link" href="/category/blog/m1-tensorflow/"><p class="RelatedPosts__PostCardEmoji-u5r1r9-2 jNtXLx"><img class="emoji" draggable="false" alt="💪" src="https://twemoji.maxcdn.com/v/12.1.6/svg/1f4aa.svg"/></p><div class="RelatedPosts__PostCardContent-u5r1r9-3 ejjRZu"><h5>[Tensorflow] M1에서 Tensorflow GPU 사용하기 (Monterey)</h5><time>2021.11.13</time></div></a></div><div class="RelatedPosts__PostCardWrapper-u5r1r9-1 htBxaS"><a class="post-card-link" href="/category/blog/effective-python/"><p class="RelatedPosts__PostCardEmoji-u5r1r9-2 jNtXLx"><img class="emoji" draggable="false" alt="📚" src="https://twemoji.maxcdn.com/v/12.1.6/svg/1f4da.svg"/></p><div class="RelatedPosts__PostCardContent-u5r1r9-3 ejjRZu"><h5>[책] 파이썬 코딩의 기술</h5><time>2021.11.02</time></div></a></div><div class="RelatedPosts__PostCardWrapper-u5r1r9-1 htBxaS"><a class="post-card-link" href="/category/blog/mlops/simple_model_deploy_mnist/"><p class="RelatedPosts__PostCardEmoji-u5r1r9-2 jNtXLx"><img class="emoji" draggable="false" alt="🏃" src="https://twemoji.maxcdn.com/v/12.1.6/svg/1f3c3.svg"/></p><div class="RelatedPosts__PostCardContent-u5r1r9-3 ejjRZu"><h5>[MLOps] Vertex AI에서 모델 배포하기 (MNIST)</h5><time>2021.11.01</time></div></a></div></div><div></div></aside></section></div><div class="TableOfContents__TableIndex-v24s1h-0 cuevDS"><div class="TableOfContents__TableWrapper-v24s1h-1 AxgAV table-of-contents"><h1 class="TableOfContents__TableHeader-v24s1h-2 bpgLWH">🔖 Catalog</h1><div class="TableOfContents__TableContents-v24s1h-3 gFKJVf"><ul>
<li><a href="/category/blog/mlops/mnist_training_vertex/#1-trainpy-%ED%8C%8C%EC%9D%BC-%EB%A7%8C%EB%93%A4%EA%B8%B0">1. train.py 파일 만들기</a></li>
<li>
<p><a href="/category/blog/mlops/mnist_training_vertex/#2-%EB%8F%84%EC%BB%A4-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88%EB%A1%9C-%ED%8C%A8%ED%82%A4%EC%A7%95%ED%95%98%EA%B8%B0">2. 도커 컨테이너로 패키징하기</a></p>
<ul>
<li>
<ul>
<li><a href="/category/blog/mlops/mnist_training_vertex/#dockerfile">Dockerfile</a></li>
<li><a href="/category/blog/mlops/mnist_training_vertex/#build--push">Build &#x26; Push</a></li>
</ul>
</li>
</ul>
</li>
<li>
<p><a href="/category/blog/mlops/mnist_training_vertex/#3-vertex-ai%EC%97%90-train-job-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0">3. Vertex AI에 Train JOB 생성하기</a></p>
<ul>
<li>
<ul>
<li><a href="/category/blog/mlops/mnist_training_vertex/#1-train-pipeline-%EB%A7%8C%EB%93%A4%EA%B8%B0">1. Train Pipeline 만들기</a></li>
<li><a href="/category/blog/mlops/mnist_training_vertex/#2-train-pipeline-configure">2. Train Pipeline Configure</a></li>
<li><a href="/category/blog/mlops/mnist_training_vertex/#3-%ED%95%99%EC%8A%B5%EC%8B%9C%EC%9E%91">3. 학습시작</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/category/blog/mlops/mnist_training_vertex/#4-%EB%B0%B0%ED%8F%AC-%EB%B0%8F-%EC%84%9C%EB%B9%99">4. 배포 및 서빙</a></li>
<li>
<p><a href="/category/blog/mlops/mnist_training_vertex/#5-test">5. Test</a></p>
<ul>
<li>
<ul>
<li><a href="/category/blog/mlops/mnist_training_vertex/#%ED%8C%8C%EC%9D%B4%EC%8D%AC%EC%97%90%EC%84%9C-%EC%98%88%EC%B8%A1%EC%9D%84-%EC%88%98%ED%96%89%ED%95%B4%EB%B3%B4%EC%9E%90">파이썬에서 예측을 수행해보자</a></li>
</ul>
</li>
</ul>
</li>
</ul></div></div></div></div></main></div></div><footer class="Footer__FooterContent-bp79pz-0 kilaSx"><div class="ContentWrapper__IndexContent-sc-184f5wv-0 gNlojF"><div class="Footer__FooterInner-bp79pz-1 bvCMhp"><div>© <!-- -->2022<!-- -->, Ssuwani. All rights reserved.</div></div></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-MM0QK4NLQE"></script><script>
    window.GATSBY_GTAG_PLUGIN_GA_TRACKING_ID = (
      'G-MM0QK4NLQE'
    );
    window.GATSBY_GTAG_PLUGIN_ANONYMIZE = true;

    var options = {
      send_page_view: false
    };
    if (true) {
      options.anonymize_ip = true;
    }

    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    window.gtag = gtag;
    gtag('js', new Date());
    gtag('config', 'G-MM0QK4NLQE', options);
  </script><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'none', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/category/blog/mlops/mnist_training_vertex/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-e1cbbafd9e0d67222ba1.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-71ad33effa27f873a1fc.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-7c091102bb3698204e45.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-1d80a09e79bd1fe70c2b.js"],"component---src-templates-categories-tsx":["/component---src-templates-categories-tsx-5e2cc865b8dd8344b8ea.js"],"component---src-templates-post-tsx":["/component---src-templates-post-tsx-ee1c336a1aa63cfbc58e.js"]};/*]]>*/</script><script src="/component---src-templates-post-tsx-ee1c336a1aa63cfbc58e.js" async=""></script><script src="/53b27b57f60ee3e1ca57a66cde9add975dffb161-2b60719b91291bfda095.js" async=""></script><script src="/de71a805-ab927e1633c63597cfb4.js" async=""></script><script src="/app-e1cbbafd9e0d67222ba1.js" async=""></script><script src="/styles-09367947dddffb36886c.js" async=""></script><script src="/framework-59a9ef51c55d9b62f7de.js" async=""></script><script src="/webpack-runtime-91cbc5ed6c6972297464.js" async=""></script></body></html>